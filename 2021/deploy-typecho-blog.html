<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.0.1" />
<meta property="og:title" content="💻【环境搭建】基于 Docker 搭建 Typecho 博客系统" />
<meta name="author" content="隐秀" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="云服务器" />
<meta property="og:description" content="云服务器" />
<link rel="canonical" href="https://blog.seriouszyx.com/2021/deploy-typecho-blog.html" />
<meta property="og:url" content="https://blog.seriouszyx.com/2021/deploy-typecho-blog.html" />
<meta property="og:site_name" content="seriouszyx’ Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-07-14T13:40:49+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="💻【环境搭建】基于 Docker 搭建 Typecho 博客系统" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"隐秀"},"dateModified":"2021-07-14T13:40:49+00:00","datePublished":"2021-07-14T13:40:49+00:00","description":"云服务器","headline":"💻【环境搭建】基于 Docker 搭建 Typecho 博客系统","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.seriouszyx.com/2021/deploy-typecho-blog.html"},"url":"https://blog.seriouszyx.com/2021/deploy-typecho-blog.html"}</script>
<!-- End Jekyll SEO tag -->
<!-- local css -->
  <link rel="stylesheet" href="https://blog.seriouszyx.com/assets/css/main.css" />
  <link rel="shortcut icon" type="image/x-icon" href="/./favicon.ico" />
  <link rel="stylesheet" href="https://blog.seriouszyx.com/assets/css/grayscale.css" />
  <!-- docsearch -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" />
  <!-- utils -->
  <link href="https://unpkg.com/tailwindcss@^2/dist/utilities.min.css" rel="stylesheet">
</head>
<body>
    <main class="page-content" aria-label="Content">
        <div class="wrapper">
            <article
  class="post h-entry"
  id="post"
  itemscope
  itemtype="http://schema.org/BlogPosting"
>
  <head>
    <title>💻【环境搭建】基于 Docker 搭建 Typecho 博客系统</title>
  </head>
  <header class="post-header">
    <div class="post-back">
      <a class="black-link" href="https://blog.seriouszyx.com">
        ← Home
      </a>
    </div>

    <h1 class="post-title p-name" itemprop="name headline">
      💻【环境搭建】基于 Docker 搭建 Typecho 博客系统
    </h1>
    <p class="post-meta">
      <time
        class="dt-published"
        datetime="2021-07-14T13:40:49+00:00"
        itemprop="datePublished"
      >Jul 14, 2021
      </time><span class="busuanzi_container_page">
        <span id="busuanzi_container_page_pv">
          •
          <span id="busuanzi_value_page_pv"></span> View
        </span>
      </span>
    </p>
  </header>

  



<ul>
  <li><a href="#云服务器">云服务器</a></li>
  <li><a href="#安装-docker">安装 Docker</a>
    <ul>
      <li><a href="#yum-换源">yum 换源</a></li>
      <li><a href="#安装-docker-1">安装 Docker</a></li>
      <li><a href="#docker-换源">Docker 换源</a></li>
    </ul>
  </li>
  <li><a href="#安装-typecho-依赖环境">安装 Typecho 依赖环境</a>
    <ul>
      <li><a href="#安装数据库-mysql">安装数据库 MySQL</a></li>
      <li><a href="#安装-nginx">安装 Nginx</a></li>
      <li><a href="#安装-php">安装 PHP</a></li>
    </ul>
  </li>
  <li><a href="#自定义-bridge-网络">自定义 Bridge 网络</a></li>
  <li><a href="#安装-typecho">安装 Typecho</a></li>
</ul>


  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="云服务器">云服务器</h1>

<p>首先一般搭建动态博客都会有一个云服务器，国内的话供应商一般是阿里云或者腾讯云，我这里使用的是腾讯云，基本的操作逻辑大同小异。</p>

<p>下面是我服务器的配置信息。</p>

<p><img src="https://img.seriouszyx.com/20210714235652.png#vwid=1646&amp;vhei=876" alt="" /></p>

<h1 id="安装-docker">安装 Docker</h1>

<h2 id="yum-换源">yum 换源</h2>

<p>首先将 yum 进行换源处理，以获得更快的下载速度。备份 <code class="highlighter-rouge">CentOS-Base.repo</code> 文件，以便更改配置文件出错恢复默认。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mv</span> /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak
</code></pre></div></div>

<p>之后下载新的 <code class="highlighter-rouge">CentOS-Base.repo</code> 到 <code class="highlighter-rouge">/etc/yum.repos.d</code> 。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget <span class="nt">-O</span> /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-8.repo
</code></pre></div></div>

<p>根据自己服务器的版本下载相应的配置文件，比如机器的操作系统是 CentOS7，就把下载链接最后的部分改为 <code class="highlighter-rouge">CentOS-7.repo</code> 。</p>

<p>下载成功后运行 <code class="highlighter-rouge">yum makecache</code> 生成缓存即可，这样使用 yum 下载软件包时访问的就是阿里的镜像，速度会快很多。</p>

<h2 id="安装-docker-1">安装 Docker</h2>

<p>在新主机上首次安装 Docker Engine-Community 之前，需要设置 Docker 仓库，之后就可以从仓库安装和更新 Docker。</p>

<p>先安装所需的软件包，<code class="highlighter-rouge">yum-utils</code> 提供了 yum-config-manager ，并且 device mapper 存储驱动程序需要 <code class="highlighter-rouge">device-mapper-persistent-data</code> 和 <code class="highlighter-rouge">lvm2</code>。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum <span class="nb">install</span> <span class="nt">-y</span> yum-utils device-mapper-persistent-data lvm2
</code></pre></div></div>

<p>使用以下命令来设置稳定的仓库，国内的阿里源会加快下载速度。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>yum-config-manager <span class="se">\</span>
    <span class="nt">--add-repo</span> <span class="se">\</span>
    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre></div></div>

<p>安装最新版本的 <code class="highlighter-rouge">Docker Engine-Community</code> 和 <code class="highlighter-rouge">containerd</code>。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum <span class="nb">install</span> <span class="nt">-y</span> docker-ce docker-ce-cli containerd.io
</code></pre></div></div>

<p>安装后输入 <code class="highlighter-rouge">serivce docker status</code>  查看 Docker 运行状态，如下所示即正常运行。</p>

<p><img src="https://img.seriouszyx.com/20210714235730.png#vwid=1695&amp;vhei=426" alt="" /></p>

<h2 id="docker-换源">Docker 换源</h2>

<p>修改镜像配置文件。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/docker/daemon.json
</code></pre></div></div>

<p>添加国内源。</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"registry-mirrors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
       </span><span class="s2">"https://docker.mirrors.ustc.edu.cn"</span><span class="p">,</span><span class="w">
       </span><span class="s2">"http://hub-mirror.c.163.com"</span><span class="p">,</span><span class="w">
       </span><span class="s2">"https://registry.docker-cn.com"</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>使用 <code class="highlighter-rouge">service docker restart</code> 命令重启 Docker 服务后生效。</p>

<h1 id="安装-typecho-依赖环境">安装 Typecho 依赖环境</h1>

<p>所有容器依赖的一些数据都放在 <code class="highlighter-rouge">/data</code> 目录下，包括数据库、网站源码、Nginx 的 conf 等，目的是为了以后迁移方便，直接将 <code class="highlighter-rouge">/data</code> 拷贝到新服务器就可以。</p>

<h2 id="安装数据库-mysql">安装数据库 MySQL</h2>

<p>使用 Docker 安装 MySQL5.7，注意密码项的自定义修改。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-d</span> <span class="nt">-p</span> 3306:3306 <span class="nt">-e</span> <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>password <span class="nt">--mount</span> <span class="nb">type</span><span class="o">=</span><span class="nb">bind</span>,source<span class="o">=</span>/data/mysql,target<span class="o">=</span>/var/lib/mysql <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">--name</span> mysql5.7 mysql:5.7
</code></pre></div></div>

<p><code class="highlighter-rouge">--mount</code> 命令也可以用 <code class="highlighter-rouge">-v /data/mysql:/var/lib/mysql</code> 代替，官方更推荐使用 <code class="highlighter-rouge">--mount</code>，详情请看<a href="https://docs.docker.com/storage/bind-mounts/">官网</a>。</p>

<p>对于 <code class="highlighter-rouge">docker run</code> 命令的部分参数说明：</p>

<ul>
  <li>-d 代表 daemon，即后台运行。</li>
  <li>-p 是映射容器的3306端口到宿主机的3306端口，规则是：<code class="highlighter-rouge">-p IP:host_port:container_port</code> 。</li>
  <li>-e 是设置 MySQL 的密码。</li>
  <li>–mount 是让容器的<code class="highlighter-rouge">/var/lib/mysql</code> 映射到宿主机的 <code class="highlighter-rouge">/data/mysql</code> 目录中。</li>
  <li>–restart=always 是为了在 Docker 重启时，容器能够自动启动。</li>
</ul>

<h2 id="安装-nginx">安装 Nginx</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-p</span> 80:80 <span class="nt">-p</span> 443:443 <span class="nt">--mount</span> <span class="nb">type</span><span class="o">=</span><span class="nb">bind</span>,source<span class="o">=</span>/data/nginx/conf.d,target<span class="o">=</span>/etc/nginx/conf.d <span class="nt">--mount</span> <span class="nb">type</span><span class="o">=</span><span class="nb">bind</span>,source<span class="o">=</span>/data/solution,target<span class="o">=</span>/data/solution <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-d</span> <span class="nt">--name</span> nginx nginx
</code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">--mount type=bind,source=/data/nginx/conf.d,target=/etc/nginx/conf.d</code> 是为了将 Nginx 的配置目录映射到宿主机的目录中，这样当 Nginx 容器被销毁时，依然能保留配置。</li>
  <li><code class="highlighter-rouge">/data/solution</code> 用于存放网站项目，也是为了数据与容器分离。</li>
  <li>-d 这里同时映射了80和443端口。</li>
</ul>

<h2 id="安装-php">安装 PHP</h2>

<p>可以在 PHP 的<a href="https://hub.docker.com/_/php">官方镜像源</a>找到最新版本的 PHP，在实际使用中，我们可能还需要装一些 PHP 的扩展，而官方源中支持已经帮我们安装了一些扩展的 PHP 镜像，如 <code class="highlighter-rouge">php:&lt;version&gt;-fpm</code>，其中的 <code class="highlighter-rouge">&lt;version&gt;</code> 指的是 PHP 版本，具体可以从官方镜像源找到。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--name</span> php-fpm <span class="nt">-p</span> 9000:9000 <span class="nt">--mount</span> <span class="nb">type</span><span class="o">=</span><span class="nb">bind</span>,source<span class="o">=</span>/data/solution,target<span class="o">=</span>/data/solution <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-d</span> php:7.4-fpm
</code></pre></div></div>

<p>这里也将网站根目录 <code class="highlighter-rouge">/data/solution</code> 映射到 PHP 容器中，为了 PHP 能正确读取 Nginx 中的 root 配置项。</p>

<p>由于 Typecho 需要用到 <code class="highlighter-rouge">pdo_mysql</code> 扩展，因此要在 <code class="highlighter-rouge">php-fpm</code> 上安装这个扩展。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 进入到`php-fpm`容器内部</span>
docker <span class="nb">exec</span> <span class="nt">-it</span> php-fpm bash
<span class="c"># 安装扩展</span>
docker-php-ext-install pdo_mysql
<span class="c"># 查看是否已经成功安装</span>
php <span class="nt">-m</span>
<span class="c"># 退出容器</span>
<span class="nb">exit</span>
</code></pre></div></div>

<p>安装后重启 <code class="highlighter-rouge">php-fpm</code>，<code class="highlighter-rouge">pdo_mysql</code> 则安装成功。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker restart php-fpm
</code></pre></div></div>

<h1 id="自定义-bridge-网络">自定义 Bridge 网络</h1>

<p>执行命令看一下，现在机器上已经运行着 Nginx、PHP、MySQL 三个服务，现在需要让它们之间能够相互通信，这里使用自定义 Bridge 网络的方法。</p>

<p><img src="https://img.seriouszyx.com/20210714235804.png#vwid=1377&amp;vhei=99" alt="" /></p>

<p>实际上启动容器时，Docker 会将容器绑定到默认的 Bridge 网络中，使用 <code class="highlighter-rouge">docker network inspect bridge</code> 命令打印此时默认的网络：</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"typecho"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"d9d06a7e7410e75183eb09019bb895a12a01d2f7405f80e09d40811c578ff396"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-06-11T13:10:53.453912588+08:00"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"local"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Driver"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bridge"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"EnableIPv6"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"IPAM"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Driver"</span><span class="p">:</span><span class="w"> </span><span class="s2">"default"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Options"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
            </span><span class="nl">"Config"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"Subnet"</span><span class="p">:</span><span class="w"> </span><span class="s2">"172.18.0.0/16"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"Gateway"</span><span class="p">:</span><span class="w"> </span><span class="s2">"172.18.0.1"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"Internal"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Attachable"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Ingress"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"ConfigFrom"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Network"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"ConfigOnly"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Containers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"2d4b9daf908252e40b8cca8e772e9dece8c1c36a467f2846fc0786d4964817cd"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"Name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mysql5.7"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"EndpointID"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8afe4a42884234acda9c8b996faed20d98015e6c919455edaf0d24f63bc22764"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"MacAddress"</span><span class="p">:</span><span class="w"> </span><span class="s2">"02:42:ac:12:00:02"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"IPv4Address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"172.18.0.2/16"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"IPv6Address"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"8cd032a4eeff30e7a54d81b6f92449160b243c793ba9d1a239cb4587896f2721"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"Name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"php-fpm"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"EndpointID"</span><span class="p">:</span><span class="w"> </span><span class="s2">"211aa7e5ab248aee84cc7875b76842037e1c597eb3f5b546b3705ac971c52c0a"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"MacAddress"</span><span class="p">:</span><span class="w"> </span><span class="s2">"02:42:ac:12:00:04"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"IPv4Address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"172.18.0.4/16"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"IPv6Address"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"ff4b411e355f1000552b892601164499a0c077fdd4a8eb22bb8c5e92f0757d83"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"Name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nginx"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"EndpointID"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e10b908ac0e0f6bd872a0b23d7ff30f58845700b7fe48568325d73ad38ba1747"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"MacAddress"</span><span class="p">:</span><span class="w"> </span><span class="s2">"02:42:ac:12:00:03"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"IPv4Address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"172.18.0.3/16"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"IPv6Address"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"Options"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
        </span><span class="nl">"Labels"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>可以看到 MySQL、php-fpm、Nginx 在默认 Bridge 中的 IP 分别是 <code class="highlighter-rouge">172.18.0.2</code>、<code class="highlighter-rouge">172.18.0.4</code>、<code class="highlighter-rouge">172.18.0.3</code>，  可以通过容器在宿主机中的 IP 来访问对应的服务，比如 php-fpm 想要访问 MySQL，可以在 php-fpm 容器中通过 <code class="highlighter-rouge">172.18.0.2:3306</code> 来访问。</p>

<p>这种方式只能使用 IP 来访问对应的容器的服务，而 IP 可能会变化的，因此是不推荐使用在生产环境的。而用户自定义的 Bridge 网络，不仅支持 IP 访问，还支持直接使用容器名称访问。</p>

<p>创建一个自定义 Bridge 网络，假设名称是 <code class="highlighter-rouge">typecho</code>。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker network create typecho
</code></pre></div></div>

<p>通过 <code class="highlighter-rouge">docker network connect ${网络名} ${容器名}</code> 来将容器绑定到 <code class="highlighter-rouge">typecho</code> 网络上。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker network connect typecho mysql5.7
docker network connect typecho php-fpm
docker network connect typecho nginx
</code></pre></div></div>

<p>现在三个容器已经绑定到自定义的 Bridge 网络上了。例如，在 Nginx 容器中，就可以直接通过 <code class="highlighter-rouge">php-fpm</code> 的名字来调用 PHP 的服务了。</p>

<h1 id="安装-typecho">安装 Typecho</h1>

<p>进入 MySQL 容器创建数据库 <code class="highlighter-rouge">typecho</code> 。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nb">exec</span> <span class="nt">-it</span> mysql5.7 bash
mysql <span class="nt">-uroot</span> <span class="nt">-p</span> 
输入密码
create database typecho<span class="p">;</span>
</code></pre></div></div>

<p>进入 Typecho 官方<a href="https://typecho.org/download">下载页面</a>，发现分为<code class="highlighter-rouge">稳定版</code>和<code class="highlighter-rouge">开发版</code>两种，按照一般的软件安装思路，当然是选择稳定版，但是 Typecho 的稳定版在2017年后就没有更新了，会遇到许多问题，比如我之前的安装中就遇到了<a href="https://github.com/typecho/typecho/issues/683">此类错误</a> ，随后切换至开发版后问题解决。</p>

<p>复制开发版的下载链接，下载到服务器的 <code class="highlighter-rouge">/data</code> 目录下并解压到 <code class="highlighter-rouge">/solution</code> 目录下。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://nightly.link/typecho/typecho/workflows/Typecho-dev-Ci/master/typecho_build.zip 

unzip typecho_build.zip <span class="nt">-d</span> ./solution/typecho
</code></pre></div></div>

<p>然后配置 Nginx 使得网站可以正常访问。注意其中 Nginx 要访问 php-fpm，在配置文件中可通过名字访问其 Docker 容器。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>server <span class="o">{</span>
	listen 80<span class="p">;</span>
	server_name localhost<span class="p">;</span>
	root   /data/solution/typecho<span class="p">;</span>   <span class="c"># 这里是网站的存放路径</span>
  index  index.php<span class="p">;</span>

	<span class="c"># 下面直接照写</span>
	location / <span class="o">{</span>
    	try_files <span class="nv">$uri</span> <span class="nv">$uri</span>/ /index.php<span class="nv">$is_args$args</span><span class="p">;</span>
	<span class="o">}</span>
	
	location ~ <span class="se">\.</span>php<span class="nv">$ </span><span class="o">{</span>
        include fastcgi.conf<span class="p">;</span>
        include fastcgi_params<span class="p">;</span>
        fastcgi_pass php-fpm:9000<span class="p">;</span>
    <span class="o">}</span>
	
<span class="o">}</span>
</code></pre></div></div>

<p>配置成功后重启 Nginx 容器，访问服务器的 IP 地址，开始配置 Typecho 博客系统。</p>

<p><img src="https://img.seriouszyx.com/20210714235847.png#vwid=1920&amp;vhei=946" alt="" /></p>

<p>数据库适配器选择安装好的 <code class="highlighter-rouge">pdo-mysql</code> ，因为已经配置了自定义 Bridge 网络，数据库地址填入容器名即可访问数据库。</p>

<p><img src="https://img.seriouszyx.com/20210714235921.png#vwid=1920&amp;vhei=2145" alt="" /></p>

<p>完成配置信息后会显示如下界面，需要复制文本框中的内容，然后创建 <code class="highlighter-rouge">config.inc.php</code> 文件粘贴进去。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /data/solution/typecho/config.inc.php
</code></pre></div></div>

<p><img src="https://img.seriouszyx.com/20210714235946.png#vwid=1920&amp;vhei=781" alt="" /></p>

<p>最终会显示安装成功页面，并可以查看默认的用户名和密码。</p>

<p><img src="https://img.seriouszyx.com/20210715000019.png#vwid=1920&amp;vhei=944" alt="" /></p>

<p>下面两个链接分别是博客页面和后台控制面板。</p>

<p><img src="https://img.seriouszyx.com/20210715000053.png#vwid=1920&amp;vhei=1015" alt="" /></p>

<p><img src="https://img.seriouszyx.com/20210715000124.png#vwid=1920&amp;vhei=950" alt="" /></p>

<p>Typecho 博客系统至此安装完成。</p>

<hr />

<ol>
  <li><a href="https://segmentfault.com/a/1190000021390958">Centos8使用docker迁移typecho博客</a></li>
  <li><a href="https://blog.csdn.net/wudinaniya/article/details/105758739">将CentOS的yum源更换为国内镜像源</a></li>
  <li><a href="https://www.runoob.com/docker/centos-docker-install.html">CentOS Docker 安装</a></li>
  <li><a href="https://wiki.dongxing.xin/pages/b1c12d/#php-%E5%AE%89%E8%A3%85">Typecho 环境配置和博客搭建</a></li>
</ol>

  </div>

  <a class="u-url" href="/2021/deploy-typecho-blog.html" hidden></a>
</article>

<div class="ant-alert mb-0">
  <ul>
    <li>版权声明：本文采用<a target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">知识共享 3.0 许可证</a> (<strong>保持署名</strong>-自由转载-非商用-非衍生)</li>
    <li>发表于 2021-07-14
    </li>
  </ul>
  
</div>

<div class="page-navigation">
  
  <a class="prev" href="/2021/scanner-analysis-and-detect.html">&laquo; 上一篇</a>
   
  <a class="next" href="/2021/what-is-blockchain.html">下一篇 &raquo;</a>
  
</div><div id="gitalk-container">
</div>
<script>
    var gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        repo: 'blog',
        owner: 'imageslr',
        admin: ['imageslr'],
        id: md5(location.pathname),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false,  // Facebook-like distraction free mode
        createIssueManually: true,
        pagerDirection: "first",
        perPage: 25,
    })
    gitalk.render('gitalk-container')
</script>
        </div>
    </main><footer class="site-footer h-card">
    <data class="u-url" href="/"></data>
    <div class="wrapper">
      <div class="footer-col-wrapper">
        <div class="footer-col">
          <ul class="contact-list">
            <li class="p-name"><a class="black-link" href="https://blog.seriouszyx.com/about.html">
                  隐秀 
                </a></li><li>
              <a class="u-email black-link" href="mailto:seriouszyx@gmail.com">seriouszyx@gmail.com</a></li></ul>
        </div>
      </div>
    </div>
    <div class="text-center">
      <a class="text-gray-300 text-sm" href="https://beian.miit.gov.cn">辽ICP备19014015号</a>
    </div>
  </footer>

  <!-- highlight js -->
  <script src="https://cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-chtml.js"></script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } });
  </script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        processEscapes: true
      }
    });
  </script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><!-- gitalk --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script>
  <script src="/assets/js/md5.min.js"></script><!-- viewerjs -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/viewerjs@1.10.4/dist/viewer.min.css">
  <script src="https://cdn.jsdelivr.net/npm/viewerjs@1.10.4/dist/viewer.min.js"></script>
  <script>
    var el = document.getElementById('post');
    if (el) new Viewer(el);
  </script>

  
  <!-- google analytics --><link type="application/atom+xml" rel="alternate" href="https://blog.seriouszyx.com/feed.xml" title="seriouszyx' Blog" /><script>
  (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();
  </script></body>
</html>