<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.0.1" />
<meta property="og:title" content="ğŸ’»ã€ç¯å¢ƒæ­å»ºã€‘åŸºäº Docker æ­å»º Typecho åšå®¢ç³»ç»Ÿ" />
<meta name="author" content="éšç§€" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="äº‘æœåŠ¡å™¨" />
<meta property="og:description" content="äº‘æœåŠ¡å™¨" />
<link rel="canonical" href="https://blog.seriouszyx.com/2021/deploy-typecho-blog.html" />
<meta property="og:url" content="https://blog.seriouszyx.com/2021/deploy-typecho-blog.html" />
<meta property="og:site_name" content="seriouszyxâ€™ Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-07-14T13:40:49+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ğŸ’»ã€ç¯å¢ƒæ­å»ºã€‘åŸºäº Docker æ­å»º Typecho åšå®¢ç³»ç»Ÿ" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"éšç§€"},"dateModified":"2021-07-14T13:40:49+00:00","datePublished":"2021-07-14T13:40:49+00:00","description":"äº‘æœåŠ¡å™¨","headline":"ğŸ’»ã€ç¯å¢ƒæ­å»ºã€‘åŸºäº Docker æ­å»º Typecho åšå®¢ç³»ç»Ÿ","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.seriouszyx.com/2021/deploy-typecho-blog.html"},"url":"https://blog.seriouszyx.com/2021/deploy-typecho-blog.html"}</script>
<!-- End Jekyll SEO tag -->
<!-- local css -->
  <link rel="stylesheet" href="https://blog.seriouszyx.com/assets/css/main.css" />
  <link rel="shortcut icon" type="image/x-icon" href="/./favicon.ico" />
  <link rel="stylesheet" href="https://blog.seriouszyx.com/assets/css/grayscale.css" />
  <!-- docsearch -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" />
  <!-- utils -->
  <link href="https://unpkg.com/tailwindcss@^2/dist/utilities.min.css" rel="stylesheet">
</head>
<body>
    <main class="page-content" aria-label="Content">
        <div class="wrapper">
            <article
  class="post h-entry"
  id="post"
  itemscope
  itemtype="http://schema.org/BlogPosting"
>
  <head>
    <title>ğŸ’»ã€ç¯å¢ƒæ­å»ºã€‘åŸºäº Docker æ­å»º Typecho åšå®¢ç³»ç»Ÿ</title>
  </head>
  <header class="post-header">
    <div class="post-back">
      <a class="black-link" href="https://blog.seriouszyx.com">
        â† Home
      </a>
    </div>

    <h1 class="post-title p-name" itemprop="name headline">
      ğŸ’»ã€ç¯å¢ƒæ­å»ºã€‘åŸºäº Docker æ­å»º Typecho åšå®¢ç³»ç»Ÿ
    </h1>
    <p class="post-meta">
      <time
        class="dt-published"
        datetime="2021-07-14T13:40:49+00:00"
        itemprop="datePublished"
      >Jul 14, 2021
      </time><span class="busuanzi_container_page">
        <span id="busuanzi_container_page_pv">
          â€¢
          <span id="busuanzi_value_page_pv"></span> View
        </span>
      </span>
    </p>
  </header>

  



<ul>
  <li><a href="#äº‘æœåŠ¡å™¨">äº‘æœåŠ¡å™¨</a></li>
  <li><a href="#å®‰è£…-docker">å®‰è£… Docker</a>
    <ul>
      <li><a href="#yum-æ¢æº">yum æ¢æº</a></li>
      <li><a href="#å®‰è£…-docker-1">å®‰è£… Docker</a></li>
      <li><a href="#docker-æ¢æº">Docker æ¢æº</a></li>
    </ul>
  </li>
  <li><a href="#å®‰è£…-typecho-ä¾èµ–ç¯å¢ƒ">å®‰è£… Typecho ä¾èµ–ç¯å¢ƒ</a>
    <ul>
      <li><a href="#å®‰è£…æ•°æ®åº“-mysql">å®‰è£…æ•°æ®åº“ MySQL</a></li>
      <li><a href="#å®‰è£…-nginx">å®‰è£… Nginx</a></li>
      <li><a href="#å®‰è£…-php">å®‰è£… PHP</a></li>
    </ul>
  </li>
  <li><a href="#è‡ªå®šä¹‰-bridge-ç½‘ç»œ">è‡ªå®šä¹‰ Bridge ç½‘ç»œ</a></li>
  <li><a href="#å®‰è£…-typecho">å®‰è£… Typecho</a></li>
</ul>


  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="äº‘æœåŠ¡å™¨">äº‘æœåŠ¡å™¨</h1>

<p>é¦–å…ˆä¸€èˆ¬æ­å»ºåŠ¨æ€åšå®¢éƒ½ä¼šæœ‰ä¸€ä¸ªäº‘æœåŠ¡å™¨ï¼Œå›½å†…çš„è¯ä¾›åº”å•†ä¸€èˆ¬æ˜¯é˜¿é‡Œäº‘æˆ–è€…è…¾è®¯äº‘ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯è…¾è®¯äº‘ï¼ŒåŸºæœ¬çš„æ“ä½œé€»è¾‘å¤§åŒå°å¼‚ã€‚</p>

<p>ä¸‹é¢æ˜¯æˆ‘æœåŠ¡å™¨çš„é…ç½®ä¿¡æ¯ã€‚</p>

<p><img src="https://img.seriouszyx.com/20210714235652.png#vwid=1646&amp;vhei=876" alt="" /></p>

<h1 id="å®‰è£…-docker">å®‰è£… Docker</h1>

<h2 id="yum-æ¢æº">yum æ¢æº</h2>

<p>é¦–å…ˆå°† yum è¿›è¡Œæ¢æºå¤„ç†ï¼Œä»¥è·å¾—æ›´å¿«çš„ä¸‹è½½é€Ÿåº¦ã€‚å¤‡ä»½ <code class="highlighter-rouge">CentOS-Base.repo</code> æ–‡ä»¶ï¼Œä»¥ä¾¿æ›´æ”¹é…ç½®æ–‡ä»¶å‡ºé”™æ¢å¤é»˜è®¤ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mv</span> /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak
</code></pre></div></div>

<p>ä¹‹åä¸‹è½½æ–°çš„ <code class="highlighter-rouge">CentOS-Base.repo</code> åˆ° <code class="highlighter-rouge">/etc/yum.repos.d</code> ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget <span class="nt">-O</span> /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-8.repo
</code></pre></div></div>

<p>æ ¹æ®è‡ªå·±æœåŠ¡å™¨çš„ç‰ˆæœ¬ä¸‹è½½ç›¸åº”çš„é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚æœºå™¨çš„æ“ä½œç³»ç»Ÿæ˜¯ CentOS7ï¼Œå°±æŠŠä¸‹è½½é“¾æ¥æœ€åçš„éƒ¨åˆ†æ”¹ä¸º <code class="highlighter-rouge">CentOS-7.repo</code> ã€‚</p>

<p>ä¸‹è½½æˆåŠŸåè¿è¡Œ <code class="highlighter-rouge">yum makecache</code> ç”Ÿæˆç¼“å­˜å³å¯ï¼Œè¿™æ ·ä½¿ç”¨ yum ä¸‹è½½è½¯ä»¶åŒ…æ—¶è®¿é—®çš„å°±æ˜¯é˜¿é‡Œçš„é•œåƒï¼Œé€Ÿåº¦ä¼šå¿«å¾ˆå¤šã€‚</p>

<h2 id="å®‰è£…-docker-1">å®‰è£… Docker</h2>

<p>åœ¨æ–°ä¸»æœºä¸Šé¦–æ¬¡å®‰è£… Docker Engine-Community ä¹‹å‰ï¼Œéœ€è¦è®¾ç½® Docker ä»“åº“ï¼Œä¹‹åå°±å¯ä»¥ä»ä»“åº“å®‰è£…å’Œæ›´æ–° Dockerã€‚</p>

<p>å…ˆå®‰è£…æ‰€éœ€çš„è½¯ä»¶åŒ…ï¼Œ<code class="highlighter-rouge">yum-utils</code> æä¾›äº† yum-config-manager ï¼Œå¹¶ä¸” device mapper å­˜å‚¨é©±åŠ¨ç¨‹åºéœ€è¦ <code class="highlighter-rouge">device-mapper-persistent-data</code> å’Œ <code class="highlighter-rouge">lvm2</code>ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum <span class="nb">install</span> <span class="nt">-y</span> yum-utils device-mapper-persistent-data lvm2
</code></pre></div></div>

<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥è®¾ç½®ç¨³å®šçš„ä»“åº“ï¼Œå›½å†…çš„é˜¿é‡Œæºä¼šåŠ å¿«ä¸‹è½½é€Ÿåº¦ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>yum-config-manager <span class="se">\</span>
    <span class="nt">--add-repo</span> <span class="se">\</span>
    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre></div></div>

<p>å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ <code class="highlighter-rouge">Docker Engine-Community</code> å’Œ <code class="highlighter-rouge">containerd</code>ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum <span class="nb">install</span> <span class="nt">-y</span> docker-ce docker-ce-cli containerd.io
</code></pre></div></div>

<p>å®‰è£…åè¾“å…¥ <code class="highlighter-rouge">serivce docker status</code>  æŸ¥çœ‹ Docker è¿è¡ŒçŠ¶æ€ï¼Œå¦‚ä¸‹æ‰€ç¤ºå³æ­£å¸¸è¿è¡Œã€‚</p>

<p><img src="https://img.seriouszyx.com/20210714235730.png#vwid=1695&amp;vhei=426" alt="" /></p>

<h2 id="docker-æ¢æº">Docker æ¢æº</h2>

<p>ä¿®æ”¹é•œåƒé…ç½®æ–‡ä»¶ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/docker/daemon.json
</code></pre></div></div>

<p>æ·»åŠ å›½å†…æºã€‚</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"registry-mirrors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
       </span><span class="s2">"https://docker.mirrors.ustc.edu.cn"</span><span class="p">,</span><span class="w">
       </span><span class="s2">"http://hub-mirror.c.163.com"</span><span class="p">,</span><span class="w">
       </span><span class="s2">"https://registry.docker-cn.com"</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>ä½¿ç”¨ <code class="highlighter-rouge">service docker restart</code> å‘½ä»¤é‡å¯ Docker æœåŠ¡åç”Ÿæ•ˆã€‚</p>

<h1 id="å®‰è£…-typecho-ä¾èµ–ç¯å¢ƒ">å®‰è£… Typecho ä¾èµ–ç¯å¢ƒ</h1>

<p>æ‰€æœ‰å®¹å™¨ä¾èµ–çš„ä¸€äº›æ•°æ®éƒ½æ”¾åœ¨ <code class="highlighter-rouge">/data</code> ç›®å½•ä¸‹ï¼ŒåŒ…æ‹¬æ•°æ®åº“ã€ç½‘ç«™æºç ã€Nginx çš„ conf ç­‰ï¼Œç›®çš„æ˜¯ä¸ºäº†ä»¥åè¿ç§»æ–¹ä¾¿ï¼Œç›´æ¥å°† <code class="highlighter-rouge">/data</code> æ‹·è´åˆ°æ–°æœåŠ¡å™¨å°±å¯ä»¥ã€‚</p>

<h2 id="å®‰è£…æ•°æ®åº“-mysql">å®‰è£…æ•°æ®åº“ MySQL</h2>

<p>ä½¿ç”¨ Docker å®‰è£… MySQL5.7ï¼Œæ³¨æ„å¯†ç é¡¹çš„è‡ªå®šä¹‰ä¿®æ”¹ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-d</span> <span class="nt">-p</span> 3306:3306 <span class="nt">-e</span> <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>password <span class="nt">--mount</span> <span class="nb">type</span><span class="o">=</span><span class="nb">bind</span>,source<span class="o">=</span>/data/mysql,target<span class="o">=</span>/var/lib/mysql <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">--name</span> mysql5.7 mysql:5.7
</code></pre></div></div>

<p><code class="highlighter-rouge">--mount</code> å‘½ä»¤ä¹Ÿå¯ä»¥ç”¨ <code class="highlighter-rouge">-v /data/mysql:/var/lib/mysql</code> ä»£æ›¿ï¼Œå®˜æ–¹æ›´æ¨èä½¿ç”¨ <code class="highlighter-rouge">--mount</code>ï¼Œè¯¦æƒ…è¯·çœ‹<a href="https://docs.docker.com/storage/bind-mounts/">å®˜ç½‘</a>ã€‚</p>

<p>å¯¹äº <code class="highlighter-rouge">docker run</code> å‘½ä»¤çš„éƒ¨åˆ†å‚æ•°è¯´æ˜ï¼š</p>

<ul>
  <li>-d ä»£è¡¨ daemonï¼Œå³åå°è¿è¡Œã€‚</li>
  <li>-p æ˜¯æ˜ å°„å®¹å™¨çš„3306ç«¯å£åˆ°å®¿ä¸»æœºçš„3306ç«¯å£ï¼Œè§„åˆ™æ˜¯ï¼š<code class="highlighter-rouge">-p IP:host_port:container_port</code> ã€‚</li>
  <li>-e æ˜¯è®¾ç½® MySQL çš„å¯†ç ã€‚</li>
  <li>â€“mount æ˜¯è®©å®¹å™¨çš„<code class="highlighter-rouge">/var/lib/mysql</code> æ˜ å°„åˆ°å®¿ä¸»æœºçš„ <code class="highlighter-rouge">/data/mysql</code> ç›®å½•ä¸­ã€‚</li>
  <li>â€“restart=always æ˜¯ä¸ºäº†åœ¨ Docker é‡å¯æ—¶ï¼Œå®¹å™¨èƒ½å¤Ÿè‡ªåŠ¨å¯åŠ¨ã€‚</li>
</ul>

<h2 id="å®‰è£…-nginx">å®‰è£… Nginx</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-p</span> 80:80 <span class="nt">-p</span> 443:443 <span class="nt">--mount</span> <span class="nb">type</span><span class="o">=</span><span class="nb">bind</span>,source<span class="o">=</span>/data/nginx/conf.d,target<span class="o">=</span>/etc/nginx/conf.d <span class="nt">--mount</span> <span class="nb">type</span><span class="o">=</span><span class="nb">bind</span>,source<span class="o">=</span>/data/solution,target<span class="o">=</span>/data/solution <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-d</span> <span class="nt">--name</span> nginx nginx
</code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">--mount type=bind,source=/data/nginx/conf.d,target=/etc/nginx/conf.d</code> æ˜¯ä¸ºäº†å°† Nginx çš„é…ç½®ç›®å½•æ˜ å°„åˆ°å®¿ä¸»æœºçš„ç›®å½•ä¸­ï¼Œè¿™æ ·å½“ Nginx å®¹å™¨è¢«é”€æ¯æ—¶ï¼Œä¾ç„¶èƒ½ä¿ç•™é…ç½®ã€‚</li>
  <li><code class="highlighter-rouge">/data/solution</code> ç”¨äºå­˜æ”¾ç½‘ç«™é¡¹ç›®ï¼Œä¹Ÿæ˜¯ä¸ºäº†æ•°æ®ä¸å®¹å™¨åˆ†ç¦»ã€‚</li>
  <li>-d è¿™é‡ŒåŒæ—¶æ˜ å°„äº†80å’Œ443ç«¯å£ã€‚</li>
</ul>

<h2 id="å®‰è£…-php">å®‰è£… PHP</h2>

<p>å¯ä»¥åœ¨ PHP çš„<a href="https://hub.docker.com/_/php">å®˜æ–¹é•œåƒæº</a>æ‰¾åˆ°æœ€æ–°ç‰ˆæœ¬çš„ PHPï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦è£…ä¸€äº› PHP çš„æ‰©å±•ï¼Œè€Œå®˜æ–¹æºä¸­æ”¯æŒå·²ç»å¸®æˆ‘ä»¬å®‰è£…äº†ä¸€äº›æ‰©å±•çš„ PHP é•œåƒï¼Œå¦‚ <code class="highlighter-rouge">php:&lt;version&gt;-fpm</code>ï¼Œå…¶ä¸­çš„ <code class="highlighter-rouge">&lt;version&gt;</code> æŒ‡çš„æ˜¯ PHP ç‰ˆæœ¬ï¼Œå…·ä½“å¯ä»¥ä»å®˜æ–¹é•œåƒæºæ‰¾åˆ°ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--name</span> php-fpm <span class="nt">-p</span> 9000:9000 <span class="nt">--mount</span> <span class="nb">type</span><span class="o">=</span><span class="nb">bind</span>,source<span class="o">=</span>/data/solution,target<span class="o">=</span>/data/solution <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-d</span> php:7.4-fpm
</code></pre></div></div>

<p>è¿™é‡Œä¹Ÿå°†ç½‘ç«™æ ¹ç›®å½• <code class="highlighter-rouge">/data/solution</code> æ˜ å°„åˆ° PHP å®¹å™¨ä¸­ï¼Œä¸ºäº† PHP èƒ½æ­£ç¡®è¯»å– Nginx ä¸­çš„ root é…ç½®é¡¹ã€‚</p>

<p>ç”±äº Typecho éœ€è¦ç”¨åˆ° <code class="highlighter-rouge">pdo_mysql</code> æ‰©å±•ï¼Œå› æ­¤è¦åœ¨ <code class="highlighter-rouge">php-fpm</code> ä¸Šå®‰è£…è¿™ä¸ªæ‰©å±•ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># è¿›å…¥åˆ°`php-fpm`å®¹å™¨å†…éƒ¨</span>
docker <span class="nb">exec</span> <span class="nt">-it</span> php-fpm bash
<span class="c"># å®‰è£…æ‰©å±•</span>
docker-php-ext-install pdo_mysql
<span class="c"># æŸ¥çœ‹æ˜¯å¦å·²ç»æˆåŠŸå®‰è£…</span>
php <span class="nt">-m</span>
<span class="c"># é€€å‡ºå®¹å™¨</span>
<span class="nb">exit</span>
</code></pre></div></div>

<p>å®‰è£…åé‡å¯ <code class="highlighter-rouge">php-fpm</code>ï¼Œ<code class="highlighter-rouge">pdo_mysql</code> åˆ™å®‰è£…æˆåŠŸã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker restart php-fpm
</code></pre></div></div>

<h1 id="è‡ªå®šä¹‰-bridge-ç½‘ç»œ">è‡ªå®šä¹‰ Bridge ç½‘ç»œ</h1>

<p>æ‰§è¡Œå‘½ä»¤çœ‹ä¸€ä¸‹ï¼Œç°åœ¨æœºå™¨ä¸Šå·²ç»è¿è¡Œç€ Nginxã€PHPã€MySQL ä¸‰ä¸ªæœåŠ¡ï¼Œç°åœ¨éœ€è¦è®©å®ƒä»¬ä¹‹é—´èƒ½å¤Ÿç›¸äº’é€šä¿¡ï¼Œè¿™é‡Œä½¿ç”¨è‡ªå®šä¹‰ Bridge ç½‘ç»œçš„æ–¹æ³•ã€‚</p>

<p><img src="https://img.seriouszyx.com/20210714235804.png#vwid=1377&amp;vhei=99" alt="" /></p>

<p>å®é™…ä¸Šå¯åŠ¨å®¹å™¨æ—¶ï¼ŒDocker ä¼šå°†å®¹å™¨ç»‘å®šåˆ°é»˜è®¤çš„ Bridge ç½‘ç»œä¸­ï¼Œä½¿ç”¨ <code class="highlighter-rouge">docker network inspect bridge</code> å‘½ä»¤æ‰“å°æ­¤æ—¶é»˜è®¤çš„ç½‘ç»œï¼š</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"typecho"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"d9d06a7e7410e75183eb09019bb895a12a01d2f7405f80e09d40811c578ff396"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-06-11T13:10:53.453912588+08:00"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"local"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Driver"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bridge"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"EnableIPv6"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"IPAM"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Driver"</span><span class="p">:</span><span class="w"> </span><span class="s2">"default"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Options"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
            </span><span class="nl">"Config"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"Subnet"</span><span class="p">:</span><span class="w"> </span><span class="s2">"172.18.0.0/16"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"Gateway"</span><span class="p">:</span><span class="w"> </span><span class="s2">"172.18.0.1"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"Internal"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Attachable"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Ingress"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"ConfigFrom"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Network"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"ConfigOnly"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Containers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"2d4b9daf908252e40b8cca8e772e9dece8c1c36a467f2846fc0786d4964817cd"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"Name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mysql5.7"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"EndpointID"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8afe4a42884234acda9c8b996faed20d98015e6c919455edaf0d24f63bc22764"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"MacAddress"</span><span class="p">:</span><span class="w"> </span><span class="s2">"02:42:ac:12:00:02"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"IPv4Address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"172.18.0.2/16"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"IPv6Address"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"8cd032a4eeff30e7a54d81b6f92449160b243c793ba9d1a239cb4587896f2721"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"Name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"php-fpm"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"EndpointID"</span><span class="p">:</span><span class="w"> </span><span class="s2">"211aa7e5ab248aee84cc7875b76842037e1c597eb3f5b546b3705ac971c52c0a"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"MacAddress"</span><span class="p">:</span><span class="w"> </span><span class="s2">"02:42:ac:12:00:04"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"IPv4Address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"172.18.0.4/16"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"IPv6Address"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"ff4b411e355f1000552b892601164499a0c077fdd4a8eb22bb8c5e92f0757d83"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"Name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nginx"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"EndpointID"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e10b908ac0e0f6bd872a0b23d7ff30f58845700b7fe48568325d73ad38ba1747"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"MacAddress"</span><span class="p">:</span><span class="w"> </span><span class="s2">"02:42:ac:12:00:03"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"IPv4Address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"172.18.0.3/16"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"IPv6Address"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"Options"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
        </span><span class="nl">"Labels"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>å¯ä»¥çœ‹åˆ° MySQLã€php-fpmã€Nginx åœ¨é»˜è®¤ Bridge ä¸­çš„ IP åˆ†åˆ«æ˜¯ <code class="highlighter-rouge">172.18.0.2</code>ã€<code class="highlighter-rouge">172.18.0.4</code>ã€<code class="highlighter-rouge">172.18.0.3</code>ï¼Œ  å¯ä»¥é€šè¿‡å®¹å™¨åœ¨å®¿ä¸»æœºä¸­çš„ IP æ¥è®¿é—®å¯¹åº”çš„æœåŠ¡ï¼Œæ¯”å¦‚ php-fpm æƒ³è¦è®¿é—® MySQLï¼Œå¯ä»¥åœ¨ php-fpm å®¹å™¨ä¸­é€šè¿‡ <code class="highlighter-rouge">172.18.0.2:3306</code> æ¥è®¿é—®ã€‚</p>

<p>è¿™ç§æ–¹å¼åªèƒ½ä½¿ç”¨ IP æ¥è®¿é—®å¯¹åº”çš„å®¹å™¨çš„æœåŠ¡ï¼Œè€Œ IP å¯èƒ½ä¼šå˜åŒ–çš„ï¼Œå› æ­¤æ˜¯ä¸æ¨èä½¿ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒçš„ã€‚è€Œç”¨æˆ·è‡ªå®šä¹‰çš„ Bridge ç½‘ç»œï¼Œä¸ä»…æ”¯æŒ IP è®¿é—®ï¼Œè¿˜æ”¯æŒç›´æ¥ä½¿ç”¨å®¹å™¨åç§°è®¿é—®ã€‚</p>

<p>åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ Bridge ç½‘ç»œï¼Œå‡è®¾åç§°æ˜¯ <code class="highlighter-rouge">typecho</code>ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker network create typecho
</code></pre></div></div>

<p>é€šè¿‡ <code class="highlighter-rouge">docker network connect ${ç½‘ç»œå} ${å®¹å™¨å}</code> æ¥å°†å®¹å™¨ç»‘å®šåˆ° <code class="highlighter-rouge">typecho</code> ç½‘ç»œä¸Šã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker network connect typecho mysql5.7
docker network connect typecho php-fpm
docker network connect typecho nginx
</code></pre></div></div>

<p>ç°åœ¨ä¸‰ä¸ªå®¹å™¨å·²ç»ç»‘å®šåˆ°è‡ªå®šä¹‰çš„ Bridge ç½‘ç»œä¸Šäº†ã€‚ä¾‹å¦‚ï¼Œåœ¨ Nginx å®¹å™¨ä¸­ï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡ <code class="highlighter-rouge">php-fpm</code> çš„åå­—æ¥è°ƒç”¨ PHP çš„æœåŠ¡äº†ã€‚</p>

<h1 id="å®‰è£…-typecho">å®‰è£… Typecho</h1>

<p>è¿›å…¥ MySQL å®¹å™¨åˆ›å»ºæ•°æ®åº“ <code class="highlighter-rouge">typecho</code> ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nb">exec</span> <span class="nt">-it</span> mysql5.7 bash
mysql <span class="nt">-uroot</span> <span class="nt">-p</span> 
è¾“å…¥å¯†ç 
create database typecho<span class="p">;</span>
</code></pre></div></div>

<p>è¿›å…¥ Typecho å®˜æ–¹<a href="https://typecho.org/download">ä¸‹è½½é¡µé¢</a>ï¼Œå‘ç°åˆ†ä¸º<code class="highlighter-rouge">ç¨³å®šç‰ˆ</code>å’Œ<code class="highlighter-rouge">å¼€å‘ç‰ˆ</code>ä¸¤ç§ï¼ŒæŒ‰ç…§ä¸€èˆ¬çš„è½¯ä»¶å®‰è£…æ€è·¯ï¼Œå½“ç„¶æ˜¯é€‰æ‹©ç¨³å®šç‰ˆï¼Œä½†æ˜¯ Typecho çš„ç¨³å®šç‰ˆåœ¨2017å¹´åå°±æ²¡æœ‰æ›´æ–°äº†ï¼Œä¼šé‡åˆ°è®¸å¤šé—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä¹‹å‰çš„å®‰è£…ä¸­å°±é‡åˆ°äº†<a href="https://github.com/typecho/typecho/issues/683">æ­¤ç±»é”™è¯¯</a> ï¼Œéšååˆ‡æ¢è‡³å¼€å‘ç‰ˆåé—®é¢˜è§£å†³ã€‚</p>

<p>å¤åˆ¶å¼€å‘ç‰ˆçš„ä¸‹è½½é“¾æ¥ï¼Œä¸‹è½½åˆ°æœåŠ¡å™¨çš„ <code class="highlighter-rouge">/data</code> ç›®å½•ä¸‹å¹¶è§£å‹åˆ° <code class="highlighter-rouge">/solution</code> ç›®å½•ä¸‹ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://nightly.link/typecho/typecho/workflows/Typecho-dev-Ci/master/typecho_build.zip 

unzip typecho_build.zip <span class="nt">-d</span> ./solution/typecho
</code></pre></div></div>

<p>ç„¶åé…ç½® Nginx ä½¿å¾—ç½‘ç«™å¯ä»¥æ­£å¸¸è®¿é—®ã€‚æ³¨æ„å…¶ä¸­ Nginx è¦è®¿é—® php-fpmï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­å¯é€šè¿‡åå­—è®¿é—®å…¶ Docker å®¹å™¨ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>server <span class="o">{</span>
	listen 80<span class="p">;</span>
	server_name localhost<span class="p">;</span>
	root   /data/solution/typecho<span class="p">;</span>   <span class="c"># è¿™é‡Œæ˜¯ç½‘ç«™çš„å­˜æ”¾è·¯å¾„</span>
  index  index.php<span class="p">;</span>

	<span class="c"># ä¸‹é¢ç›´æ¥ç…§å†™</span>
	location / <span class="o">{</span>
    	try_files <span class="nv">$uri</span> <span class="nv">$uri</span>/ /index.php<span class="nv">$is_args$args</span><span class="p">;</span>
	<span class="o">}</span>
	
	location ~ <span class="se">\.</span>php<span class="nv">$ </span><span class="o">{</span>
        include fastcgi.conf<span class="p">;</span>
        include fastcgi_params<span class="p">;</span>
        fastcgi_pass php-fpm:9000<span class="p">;</span>
    <span class="o">}</span>
	
<span class="o">}</span>
</code></pre></div></div>

<p>é…ç½®æˆåŠŸåé‡å¯ Nginx å®¹å™¨ï¼Œè®¿é—®æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œå¼€å§‹é…ç½® Typecho åšå®¢ç³»ç»Ÿã€‚</p>

<p><img src="https://img.seriouszyx.com/20210714235847.png#vwid=1920&amp;vhei=946" alt="" /></p>

<p>æ•°æ®åº“é€‚é…å™¨é€‰æ‹©å®‰è£…å¥½çš„ <code class="highlighter-rouge">pdo-mysql</code> ï¼Œå› ä¸ºå·²ç»é…ç½®äº†è‡ªå®šä¹‰ Bridge ç½‘ç»œï¼Œæ•°æ®åº“åœ°å€å¡«å…¥å®¹å™¨åå³å¯è®¿é—®æ•°æ®åº“ã€‚</p>

<p><img src="https://img.seriouszyx.com/20210714235921.png#vwid=1920&amp;vhei=2145" alt="" /></p>

<p>å®Œæˆé…ç½®ä¿¡æ¯åä¼šæ˜¾ç¤ºå¦‚ä¸‹ç•Œé¢ï¼Œéœ€è¦å¤åˆ¶æ–‡æœ¬æ¡†ä¸­çš„å†…å®¹ï¼Œç„¶ååˆ›å»º <code class="highlighter-rouge">config.inc.php</code> æ–‡ä»¶ç²˜è´´è¿›å»ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /data/solution/typecho/config.inc.php
</code></pre></div></div>

<p><img src="https://img.seriouszyx.com/20210714235946.png#vwid=1920&amp;vhei=781" alt="" /></p>

<p>æœ€ç»ˆä¼šæ˜¾ç¤ºå®‰è£…æˆåŠŸé¡µé¢ï¼Œå¹¶å¯ä»¥æŸ¥çœ‹é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç ã€‚</p>

<p><img src="https://img.seriouszyx.com/20210715000019.png#vwid=1920&amp;vhei=944" alt="" /></p>

<p>ä¸‹é¢ä¸¤ä¸ªé“¾æ¥åˆ†åˆ«æ˜¯åšå®¢é¡µé¢å’Œåå°æ§åˆ¶é¢æ¿ã€‚</p>

<p><img src="https://img.seriouszyx.com/20210715000053.png#vwid=1920&amp;vhei=1015" alt="" /></p>

<p><img src="https://img.seriouszyx.com/20210715000124.png#vwid=1920&amp;vhei=950" alt="" /></p>

<p>Typecho åšå®¢ç³»ç»Ÿè‡³æ­¤å®‰è£…å®Œæˆã€‚</p>

<hr />

<ol>
  <li><a href="https://segmentfault.com/a/1190000021390958">Centos8ä½¿ç”¨dockerè¿ç§»typechoåšå®¢</a></li>
  <li><a href="https://blog.csdn.net/wudinaniya/article/details/105758739">å°†CentOSçš„yumæºæ›´æ¢ä¸ºå›½å†…é•œåƒæº</a></li>
  <li><a href="https://www.runoob.com/docker/centos-docker-install.html">CentOS Docker å®‰è£…</a></li>
  <li><a href="https://wiki.dongxing.xin/pages/b1c12d/#php-%E5%AE%89%E8%A3%85">Typecho ç¯å¢ƒé…ç½®å’Œåšå®¢æ­å»º</a></li>
</ol>

  </div>

  <a class="u-url" href="/2021/deploy-typecho-blog.html" hidden></a>
</article>

<div class="ant-alert mb-0">
  <ul>
    <li>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡é‡‡ç”¨<a target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">çŸ¥è¯†å…±äº« 3.0 è®¸å¯è¯</a> (<strong>ä¿æŒç½²å</strong>-è‡ªç”±è½¬è½½-éå•†ç”¨-éè¡ç”Ÿ)</li>
    <li>å‘è¡¨äº 2021-07-14
    </li>
  </ul>
  
</div>

<div class="page-navigation">
  
  <a class="prev" href="/2021/scanner-analysis-and-detect.html">&laquo; ä¸Šä¸€ç¯‡</a>
   
  <a class="next" href="/2021/what-is-blockchain.html">ä¸‹ä¸€ç¯‡ &raquo;</a>
  
</div><div id="gitalk-container">
</div>
<script>
    var gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        repo: 'blog',
        owner: 'imageslr',
        admin: ['imageslr'],
        id: md5(location.pathname),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false,  // Facebook-like distraction free mode
        createIssueManually: true,
        pagerDirection: "first",
        perPage: 25,
    })
    gitalk.render('gitalk-container')
</script>
        </div>
    </main><footer class="site-footer h-card">
    <data class="u-url" href="/"></data>
    <div class="wrapper">
      <div class="footer-col-wrapper">
        <div class="footer-col">
          <ul class="contact-list">
            <li class="p-name"><a class="black-link" href="https://blog.seriouszyx.com/about.html">
                  éšç§€ 
                </a></li><li>
              <a class="u-email black-link" href="mailto:seriouszyx@gmail.com">seriouszyx@gmail.com</a></li></ul>
        </div>
      </div>
    </div>
    <div class="text-center">
      <a class="text-gray-300 text-sm" href="https://beian.miit.gov.cn">è¾½ICPå¤‡19014015å·</a>
    </div>
  </footer>

  <!-- highlight js -->
  <script src="https://cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-chtml.js"></script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } });
  </script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        processEscapes: true
      }
    });
  </script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><!-- gitalk --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script>
  <script src="/assets/js/md5.min.js"></script><!-- viewerjs -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/viewerjs@1.10.4/dist/viewer.min.css">
  <script src="https://cdn.jsdelivr.net/npm/viewerjs@1.10.4/dist/viewer.min.js"></script>
  <script>
    var el = document.getElementById('post');
    if (el) new Viewer(el);
  </script>

  
  <!-- google analytics --><link type="application/atom+xml" rel="alternate" href="https://blog.seriouszyx.com/feed.xml" title="seriouszyx' Blog" /><script>
  (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();
  </script></body>
</html>