













<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>ğŸ’»ã€ç¯å¢ƒæ­å»ºã€‘åŸºäº Docker æ­å»º Typecho åšå®¢ç³»ç»Ÿ [ éšç§€ ]</title>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prism-themes@1.9.0/themes/prism-one-light.min.css">
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  

  <link rel="stylesheet" href="/css/third_party/utilities.min.css">
  <link rel="stylesheet" href="/css/star.css">
<meta name="generator" content="Hexo 6.1.0"></head>
<body>

<main class="page-content" aria-label="Content">
  

  <div class="wrapper">
    
    
  <article 
    class="post h-entry"
    id="post"
    itemscope
    itemtype="http://schema.org/BlogPosting"
  >

  <header class="post-header">
    <div class="post-back">
      <a class="black-link" href="/">
        â† Home
      </a>
    </div>

    <h1 class="post-title p-name" itemprop="name headline">
      ğŸ’»ã€ç¯å¢ƒæ­å»ºã€‘åŸºäº Docker æ­å»º Typecho åšå®¢ç³»ç»Ÿ
    </h1>
    <p class="post-meta">
      <time
        class="dt-published"
        datetime="1626241249000"
        itemprop="datePublished"
      >
        Jul 14, 2021
      </time>â€¢
      <span itemprop="author" itemscope itemtype="http://schema.org/Person"
        ><span class="p-author h-card" itemprop="name"
          >seriouszyx</span
        ></span
      >
        <span class="busuanzi_container_page">
          <span id="busuanzi_container_page_pv">
            â€¢
          <span id="busuanzi_value_page_pv"></span> View
          </span>
        </span>
      
    </p>
  </header>

  <div class="js-toc"></div>

  <div class="post-content" itemprop="articleBody">
    <h2 id="äº‘æœåŠ¡å™¨"><a href="#äº‘æœåŠ¡å™¨" class="headerlink" title="äº‘æœåŠ¡å™¨"></a>äº‘æœåŠ¡å™¨</h2><p>é¦–å…ˆä¸€èˆ¬æ­å»ºåŠ¨æ€åšå®¢éƒ½ä¼šæœ‰ä¸€ä¸ªäº‘æœåŠ¡å™¨ï¼Œå›½å†…çš„è¯ä¾›åº”å•†ä¸€èˆ¬æ˜¯é˜¿é‡Œäº‘æˆ–è€…è…¾è®¯äº‘ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯è…¾è®¯äº‘ï¼ŒåŸºæœ¬çš„æ“ä½œé€»è¾‘å¤§åŒå°å¼‚ã€‚</p>
<p>ä¸‹é¢æ˜¯æˆ‘æœåŠ¡å™¨çš„é…ç½®ä¿¡æ¯ã€‚</p>
<p><img src="https://img.seriouszyx.com/20210714235652.png#vwid=1646&amp;vhei=876"></p>
<h2 id="å®‰è£…-Docker"><a href="#å®‰è£…-Docker" class="headerlink" title="å®‰è£… Docker"></a>å®‰è£… Docker</h2><h3 id="yum-æ¢æº"><a href="#yum-æ¢æº" class="headerlink" title="yum æ¢æº"></a>yum æ¢æº</h3><p>é¦–å…ˆå°† yum è¿›è¡Œæ¢æºå¤„ç†ï¼Œä»¥è·å¾—æ›´å¿«çš„ä¸‹è½½é€Ÿåº¦ã€‚å¤‡ä»½ <code>CentOS-Base.repo</code> æ–‡ä»¶ï¼Œä»¥ä¾¿æ›´æ”¹é…ç½®æ–‡ä»¶å‡ºé”™æ¢å¤é»˜è®¤ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mv</span> /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ä¹‹åä¸‹è½½æ–°çš„ <code>CentOS-Base.repo</code> åˆ° <code>/etc/yum.repos.d</code> ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-8.repo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æ ¹æ®è‡ªå·±æœåŠ¡å™¨çš„ç‰ˆæœ¬ä¸‹è½½ç›¸åº”çš„é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚æœºå™¨çš„æ“ä½œç³»ç»Ÿæ˜¯ CentOS7ï¼Œå°±æŠŠä¸‹è½½é“¾æ¥æœ€åçš„éƒ¨åˆ†æ”¹ä¸º <code>CentOS-7.repo</code> ã€‚</p>
<p>ä¸‹è½½æˆåŠŸåè¿è¡Œ <code>yum makecache</code> ç”Ÿæˆç¼“å­˜å³å¯ï¼Œè¿™æ ·ä½¿ç”¨ yum ä¸‹è½½è½¯ä»¶åŒ…æ—¶è®¿é—®çš„å°±æ˜¯é˜¿é‡Œçš„é•œåƒï¼Œé€Ÿåº¦ä¼šå¿«å¾ˆå¤šã€‚</p>
<h3 id="å®‰è£…-Docker-1"><a href="#å®‰è£…-Docker-1" class="headerlink" title="å®‰è£… Docker"></a>å®‰è£… Docker</h3><p>åœ¨æ–°ä¸»æœºä¸Šé¦–æ¬¡å®‰è£… Docker Engine-Community ä¹‹å‰ï¼Œéœ€è¦è®¾ç½® Docker ä»“åº“ï¼Œä¹‹åå°±å¯ä»¥ä»ä»“åº“å®‰è£…å’Œæ›´æ–° Dockerã€‚</p>
<p>å…ˆå®‰è£…æ‰€éœ€çš„è½¯ä»¶åŒ…ï¼Œ<code>yum-utils</code> æä¾›äº† yum-config-manager ï¼Œå¹¶ä¸” device mapper å­˜å‚¨é©±åŠ¨ç¨‹åºéœ€è¦ <code>device-mapper-persistent-data</code> å’Œ <code>lvm2</code>ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> -y yum-utils device-mapper-persistent-data lvm2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥è®¾ç½®ç¨³å®šçš„ä»“åº“ï¼Œå›½å†…çš„é˜¿é‡Œæºä¼šåŠ å¿«ä¸‹è½½é€Ÿåº¦ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum-config-manager <span class="token punctuation">\</span>
    --add-repo <span class="token punctuation">\</span>
    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ <code>Docker Engine-Community</code> å’Œ <code>containerd</code>ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> -y docker-ce docker-ce-cli containerd.io<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>å®‰è£…åè¾“å…¥ <code>serivce docker status</code>  æŸ¥çœ‹ Docker è¿è¡ŒçŠ¶æ€ï¼Œå¦‚ä¸‹æ‰€ç¤ºå³æ­£å¸¸è¿è¡Œã€‚</p>
<p><img src="https://img.seriouszyx.com/20210714235730.png#vwid=1695&amp;vhei=426"></p>
<h3 id="Docker-æ¢æº"><a href="#Docker-æ¢æº" class="headerlink" title="Docker æ¢æº"></a>Docker æ¢æº</h3><p>ä¿®æ”¹é•œåƒé…ç½®æ–‡ä»¶ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/docker/daemon.json<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æ·»åŠ å›½å†…æºã€‚</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"registry-mirrors"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
       <span class="token string">"https://docker.mirrors.ustc.edu.cn"</span><span class="token punctuation">,</span>
       <span class="token string">"http://hub-mirror.c.163.com"</span><span class="token punctuation">,</span>
       <span class="token string">"https://registry.docker-cn.com"</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä½¿ç”¨ <code>service docker restart</code> å‘½ä»¤é‡å¯ Docker æœåŠ¡åç”Ÿæ•ˆã€‚</p>
<h2 id="å®‰è£…-Typecho-ä¾èµ–ç¯å¢ƒ"><a href="#å®‰è£…-Typecho-ä¾èµ–ç¯å¢ƒ" class="headerlink" title="å®‰è£… Typecho ä¾èµ–ç¯å¢ƒ"></a>å®‰è£… Typecho ä¾èµ–ç¯å¢ƒ</h2><p>æ‰€æœ‰å®¹å™¨ä¾èµ–çš„ä¸€äº›æ•°æ®éƒ½æ”¾åœ¨ <code>/data</code> ç›®å½•ä¸‹ï¼ŒåŒ…æ‹¬æ•°æ®åº“ã€ç½‘ç«™æºç ã€Nginx çš„ conf ç­‰ï¼Œç›®çš„æ˜¯ä¸ºäº†ä»¥åè¿ç§»æ–¹ä¾¿ï¼Œç›´æ¥å°† <code>/data</code> æ‹·è´åˆ°æ–°æœåŠ¡å™¨å°±å¯ä»¥ã€‚</p>
<h3 id="å®‰è£…æ•°æ®åº“-MySQL"><a href="#å®‰è£…æ•°æ®åº“-MySQL" class="headerlink" title="å®‰è£…æ•°æ®åº“ MySQL"></a>å®‰è£…æ•°æ®åº“ MySQL</h3><p>ä½¿ç”¨ Docker å®‰è£… MySQL5.7ï¼Œæ³¨æ„å¯†ç é¡¹çš„è‡ªå®šä¹‰ä¿®æ”¹ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker run -d -p <span class="token number">3306</span>:3306 -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>password --mount <span class="token assign-left variable">type</span><span class="token operator">=</span>bind,source<span class="token operator">=</span>/data/mysql,target<span class="token operator">=</span>/var/lib/mysql --restart<span class="token operator">=</span>always --name mysql5.7 mysql:5.7<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>--mount</code> å‘½ä»¤ä¹Ÿå¯ä»¥ç”¨ <code>-v /data/mysql:/var/lib/mysql</code> ä»£æ›¿ï¼Œå®˜æ–¹æ›´æ¨èä½¿ç”¨ <code>--mount</code>ï¼Œè¯¦æƒ…è¯·çœ‹<a target="_blank" rel="noopener" href="https://docs.docker.com/storage/bind-mounts/">å®˜ç½‘</a>ã€‚</p>
<p>å¯¹äº <code>docker run</code> å‘½ä»¤çš„éƒ¨åˆ†å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>-d ä»£è¡¨ daemonï¼Œå³åå°è¿è¡Œã€‚</li>
<li>-p æ˜¯æ˜ å°„å®¹å™¨çš„ 3306 ç«¯å£åˆ°å®¿ä¸»æœºçš„ 3306 ç«¯å£ï¼Œè§„åˆ™æ˜¯ï¼š<code>-p IP:host_port:container_port</code> ã€‚</li>
<li>-e æ˜¯è®¾ç½® MySQL çš„å¯†ç ã€‚</li>
<li>â€“mount æ˜¯è®©å®¹å™¨çš„ <code>/var/lib/mysql</code> æ˜ å°„åˆ°å®¿ä¸»æœºçš„ <code>/data/mysql</code> ç›®å½•ä¸­ã€‚</li>
<li>â€“restart=always æ˜¯ä¸ºäº†åœ¨ Docker é‡å¯æ—¶ï¼Œå®¹å™¨èƒ½å¤Ÿè‡ªåŠ¨å¯åŠ¨ã€‚</li>
</ul>
<h3 id="å®‰è£…-Nginx"><a href="#å®‰è£…-Nginx" class="headerlink" title="å®‰è£… Nginx"></a>å®‰è£… Nginx</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker run -p <span class="token number">80</span>:80 -p <span class="token number">443</span>:443 --mount <span class="token assign-left variable">type</span><span class="token operator">=</span>bind,source<span class="token operator">=</span>/data/nginx/conf.d,target<span class="token operator">=</span>/etc/nginx/conf.d --mount <span class="token assign-left variable">type</span><span class="token operator">=</span>bind,source<span class="token operator">=</span>/data/solution,target<span class="token operator">=</span>/data/solution --restart<span class="token operator">=</span>always -d --name nginx nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><code>--mount type=bind,source=/data/nginx/conf.d,target=/etc/nginx/conf.d</code> æ˜¯ä¸ºäº†å°† Nginx çš„é…ç½®ç›®å½•æ˜ å°„åˆ°å®¿ä¸»æœºçš„ç›®å½•ä¸­ï¼Œè¿™æ ·å½“ Nginx å®¹å™¨è¢«é”€æ¯æ—¶ï¼Œä¾ç„¶èƒ½ä¿ç•™é…ç½®ã€‚</li>
<li><code>/data/solution</code> ç”¨äºå­˜æ”¾ç½‘ç«™é¡¹ç›®ï¼Œä¹Ÿæ˜¯ä¸ºäº†æ•°æ®ä¸å®¹å™¨åˆ†ç¦»ã€‚</li>
<li>-d è¿™é‡ŒåŒæ—¶æ˜ å°„äº† 80 å’Œ 443 ç«¯å£ã€‚</li>
</ul>
<h3 id="å®‰è£…-PHP"><a href="#å®‰è£…-PHP" class="headerlink" title="å®‰è£… PHP"></a>å®‰è£… PHP</h3><p>å¯ä»¥åœ¨ PHP çš„<a target="_blank" rel="noopener" href="https://hub.docker.com/_/php">å®˜æ–¹é•œåƒæº</a>æ‰¾åˆ°æœ€æ–°ç‰ˆæœ¬çš„ PHPï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦è£…ä¸€äº› PHP çš„æ‰©å±•ï¼Œè€Œå®˜æ–¹æºä¸­æ”¯æŒå·²ç»å¸®æˆ‘ä»¬å®‰è£…äº†ä¸€äº›æ‰©å±•çš„ PHP é•œåƒï¼Œå¦‚ <code>php:&lt;version&gt;-fpm</code>ï¼Œå…¶ä¸­çš„ <code>&lt;version&gt;</code> æŒ‡çš„æ˜¯ PHP ç‰ˆæœ¬ï¼Œå…·ä½“å¯ä»¥ä»å®˜æ–¹é•œåƒæºæ‰¾åˆ°ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker run --name php-fpm -p <span class="token number">9000</span>:9000 --mount <span class="token assign-left variable">type</span><span class="token operator">=</span>bind,source<span class="token operator">=</span>/data/solution,target<span class="token operator">=</span>/data/solution --restart<span class="token operator">=</span>always -d php:7.4-fpm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>è¿™é‡Œä¹Ÿå°†ç½‘ç«™æ ¹ç›®å½• <code>/data/solution</code> æ˜ å°„åˆ° PHP å®¹å™¨ä¸­ï¼Œä¸ºäº† PHP èƒ½æ­£ç¡®è¯»å– Nginx ä¸­çš„ root é…ç½®é¡¹ã€‚ </p>
<p>ç”±äº Typecho éœ€è¦ç”¨åˆ° <code>pdo_mysql</code> æ‰©å±•ï¼Œå› æ­¤è¦åœ¨ <code>php-fpm</code> ä¸Šå®‰è£…è¿™ä¸ªæ‰©å±•ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¿›å…¥åˆ°`php-fpm`å®¹å™¨å†…éƒ¨</span>
docker <span class="token builtin class-name">exec</span> -it php-fpm <span class="token function">bash</span>
<span class="token comment"># å®‰è£…æ‰©å±•</span>
docker-php-ext-install pdo_mysql
<span class="token comment"># æŸ¥çœ‹æ˜¯å¦å·²ç»æˆåŠŸå®‰è£…</span>
php -m
<span class="token comment"># é€€å‡ºå®¹å™¨</span>
<span class="token builtin class-name">exit</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å®‰è£…åé‡å¯ <code>php-fpm</code>ï¼Œ<code>pdo_mysql</code> åˆ™å®‰è£…æˆåŠŸã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker restart php-fpm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="è‡ªå®šä¹‰-Bridge-ç½‘ç»œ"><a href="#è‡ªå®šä¹‰-Bridge-ç½‘ç»œ" class="headerlink" title="è‡ªå®šä¹‰ Bridge ç½‘ç»œ"></a>è‡ªå®šä¹‰ Bridge ç½‘ç»œ</h2><p>æ‰§è¡Œå‘½ä»¤çœ‹ä¸€ä¸‹ï¼Œç°åœ¨æœºå™¨ä¸Šå·²ç»è¿è¡Œç€ Nginxã€PHPã€MySQL ä¸‰ä¸ªæœåŠ¡ï¼Œç°åœ¨éœ€è¦è®©å®ƒä»¬ä¹‹é—´èƒ½å¤Ÿç›¸äº’é€šä¿¡ï¼Œè¿™é‡Œä½¿ç”¨è‡ªå®šä¹‰ Bridge ç½‘ç»œçš„æ–¹æ³•ã€‚</p>
<p><img src="https://img.seriouszyx.com/20210714235804.png#vwid=1377&amp;vhei=99"></p>
<p>å®é™…ä¸Šå¯åŠ¨å®¹å™¨æ—¶ï¼ŒDocker ä¼šå°†å®¹å™¨ç»‘å®šåˆ°é»˜è®¤çš„ Bridge ç½‘ç»œä¸­ï¼Œä½¿ç”¨ <code>docker network inspect bridge</code> å‘½ä»¤æ‰“å°æ­¤æ—¶é»˜è®¤çš„ç½‘ç»œï¼š</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token property">"Name"</span><span class="token operator">:</span> <span class="token string">"typecho"</span><span class="token punctuation">,</span>
        <span class="token property">"Id"</span><span class="token operator">:</span> <span class="token string">"d9d06a7e7410e75183eb09019bb895a12a01d2f7405f80e09d40811c578ff396"</span><span class="token punctuation">,</span>
        <span class="token property">"Created"</span><span class="token operator">:</span> <span class="token string">"2021-06-11T13:10:53.453912588+08:00"</span><span class="token punctuation">,</span>
        <span class="token property">"Scope"</span><span class="token operator">:</span> <span class="token string">"local"</span><span class="token punctuation">,</span>
        <span class="token property">"Driver"</span><span class="token operator">:</span> <span class="token string">"bridge"</span><span class="token punctuation">,</span>
        <span class="token property">"EnableIPv6"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"IPAM"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"Driver"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>
            <span class="token property">"Options"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"Config"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token property">"Subnet"</span><span class="token operator">:</span> <span class="token string">"172.18.0.0/16"</span><span class="token punctuation">,</span>
                    <span class="token property">"Gateway"</span><span class="token operator">:</span> <span class="token string">"172.18.0.1"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"Internal"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"Attachable"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"Ingress"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"ConfigFrom"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"Network"</span><span class="token operator">:</span> <span class="token string">""</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"ConfigOnly"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">"Containers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"2d4b9daf908252e40b8cca8e772e9dece8c1c36a467f2846fc0786d4964817cd"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"Name"</span><span class="token operator">:</span> <span class="token string">"mysql5.7"</span><span class="token punctuation">,</span>
                <span class="token property">"EndpointID"</span><span class="token operator">:</span> <span class="token string">"8afe4a42884234acda9c8b996faed20d98015e6c919455edaf0d24f63bc22764"</span><span class="token punctuation">,</span>
                <span class="token property">"MacAddress"</span><span class="token operator">:</span> <span class="token string">"02:42:ac:12:00:02"</span><span class="token punctuation">,</span>
                <span class="token property">"IPv4Address"</span><span class="token operator">:</span> <span class="token string">"172.18.0.2/16"</span><span class="token punctuation">,</span>
                <span class="token property">"IPv6Address"</span><span class="token operator">:</span> <span class="token string">""</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"8cd032a4eeff30e7a54d81b6f92449160b243c793ba9d1a239cb4587896f2721"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"Name"</span><span class="token operator">:</span> <span class="token string">"php-fpm"</span><span class="token punctuation">,</span>
                <span class="token property">"EndpointID"</span><span class="token operator">:</span> <span class="token string">"211aa7e5ab248aee84cc7875b76842037e1c597eb3f5b546b3705ac971c52c0a"</span><span class="token punctuation">,</span>
                <span class="token property">"MacAddress"</span><span class="token operator">:</span> <span class="token string">"02:42:ac:12:00:04"</span><span class="token punctuation">,</span>
                <span class="token property">"IPv4Address"</span><span class="token operator">:</span> <span class="token string">"172.18.0.4/16"</span><span class="token punctuation">,</span>
                <span class="token property">"IPv6Address"</span><span class="token operator">:</span> <span class="token string">""</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"ff4b411e355f1000552b892601164499a0c077fdd4a8eb22bb8c5e92f0757d83"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"Name"</span><span class="token operator">:</span> <span class="token string">"nginx"</span><span class="token punctuation">,</span>
                <span class="token property">"EndpointID"</span><span class="token operator">:</span> <span class="token string">"e10b908ac0e0f6bd872a0b23d7ff30f58845700b7fe48568325d73ad38ba1747"</span><span class="token punctuation">,</span>
                <span class="token property">"MacAddress"</span><span class="token operator">:</span> <span class="token string">"02:42:ac:12:00:03"</span><span class="token punctuation">,</span>
                <span class="token property">"IPv4Address"</span><span class="token operator">:</span> <span class="token string">"172.18.0.3/16"</span><span class="token punctuation">,</span>
                <span class="token property">"IPv6Address"</span><span class="token operator">:</span> <span class="token string">""</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"Options"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"Labels"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å¯ä»¥çœ‹åˆ° MySQLã€php-fpmã€Nginx åœ¨é»˜è®¤ Bridge ä¸­çš„ IP åˆ†åˆ«æ˜¯ <code>172.18.0.2</code>ã€<code>172.18.0.4</code>ã€<code>172.18.0.3</code>ï¼Œ  å¯ä»¥é€šè¿‡å®¹å™¨åœ¨å®¿ä¸»æœºä¸­çš„ IP æ¥è®¿é—®å¯¹åº”çš„æœåŠ¡ï¼Œæ¯”å¦‚ php-fpm æƒ³è¦è®¿é—® MySQLï¼Œå¯ä»¥åœ¨ php-fpm å®¹å™¨ä¸­é€šè¿‡ <code>172.18.0.2:3306</code> æ¥è®¿é—®ã€‚</p>
<p>è¿™ç§æ–¹å¼åªèƒ½ä½¿ç”¨ IP æ¥è®¿é—®å¯¹åº”çš„å®¹å™¨çš„æœåŠ¡ï¼Œè€Œ IP å¯èƒ½ä¼šå˜åŒ–çš„ï¼Œå› æ­¤æ˜¯ä¸æ¨èä½¿ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒçš„ã€‚è€Œç”¨æˆ·è‡ªå®šä¹‰çš„ Bridge ç½‘ç»œï¼Œä¸ä»…æ”¯æŒ IP è®¿é—®ï¼Œè¿˜æ”¯æŒç›´æ¥ä½¿ç”¨å®¹å™¨åç§°è®¿é—®ã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ Bridge ç½‘ç»œï¼Œå‡è®¾åç§°æ˜¯ <code>typecho</code>ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker network create typecho<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>é€šè¿‡ <code>docker network connect ${ç½‘ç»œå} ${å®¹å™¨å}</code> æ¥å°†å®¹å™¨ç»‘å®šåˆ° <code>typecho</code> ç½‘ç»œä¸Šã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker network connect typecho mysql5.7
docker network connect typecho php-fpm
docker network connect typecho nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>ç°åœ¨ä¸‰ä¸ªå®¹å™¨å·²ç»ç»‘å®šåˆ°è‡ªå®šä¹‰çš„ Bridge ç½‘ç»œä¸Šäº†ã€‚ä¾‹å¦‚ï¼Œåœ¨ Nginx å®¹å™¨ä¸­ï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡ <code>php-fpm</code> çš„åå­—æ¥è°ƒç”¨ PHP çš„æœåŠ¡äº†ã€‚</p>
<h2 id="å®‰è£…-Typecho"><a href="#å®‰è£…-Typecho" class="headerlink" title="å®‰è£… Typecho"></a>å®‰è£… Typecho</h2><p>è¿›å…¥ MySQL å®¹å™¨åˆ›å»ºæ•°æ®åº“ <code>typecho</code> ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker <span class="token builtin class-name">exec</span> -it mysql5.7 <span class="token function">bash</span>
mysql -uroot -p 
è¾“å…¥å¯†ç 
create database typecho<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¿›å…¥ Typecho å®˜æ–¹<a target="_blank" rel="noopener" href="https://typecho.org/download">ä¸‹è½½é¡µé¢</a>ï¼Œå‘ç°åˆ†ä¸º<code>ç¨³å®šç‰ˆ</code>å’Œ<code>å¼€å‘ç‰ˆ</code>ä¸¤ç§ï¼ŒæŒ‰ç…§ä¸€èˆ¬çš„è½¯ä»¶å®‰è£…æ€è·¯ï¼Œå½“ç„¶æ˜¯é€‰æ‹©ç¨³å®šç‰ˆï¼Œä½†æ˜¯ Typecho çš„ç¨³å®šç‰ˆåœ¨ 2017 å¹´åå°±æ²¡æœ‰æ›´æ–°äº†ï¼Œä¼šé‡åˆ°è®¸å¤šé—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä¹‹å‰çš„å®‰è£…ä¸­å°±é‡åˆ°äº†<a target="_blank" rel="noopener" href="https://github.com/typecho/typecho/issues/683">æ­¤ç±»é”™è¯¯</a> ï¼Œéšååˆ‡æ¢è‡³å¼€å‘ç‰ˆåé—®é¢˜è§£å†³ã€‚</p>
<p>å¤åˆ¶å¼€å‘ç‰ˆçš„ä¸‹è½½é“¾æ¥ï¼Œä¸‹è½½åˆ°æœåŠ¡å™¨çš„ <code>/data</code> ç›®å½•ä¸‹å¹¶è§£å‹åˆ° <code>/solution</code> ç›®å½•ä¸‹ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> https://nightly.link/typecho/typecho/workflows/Typecho-dev-Ci/master/typecho_build.zip 

<span class="token function">unzip</span> typecho_build.zip -d ./solution/typecho<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>ç„¶åé…ç½® Nginx ä½¿å¾—ç½‘ç«™å¯ä»¥æ­£å¸¸è®¿é—®ã€‚æ³¨æ„å…¶ä¸­ Nginx è¦è®¿é—® php-fpmï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­å¯é€šè¿‡åå­—è®¿é—®å…¶ Docker å®¹å™¨ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">server <span class="token punctuation">{</span>
	listen <span class="token number">80</span><span class="token punctuation">;</span>
	server_name localhost<span class="token punctuation">;</span>
	root   /data/solution/typecho<span class="token punctuation">;</span>   <span class="token comment"># è¿™é‡Œæ˜¯ç½‘ç«™çš„å­˜æ”¾è·¯å¾„</span>
  index  index.php<span class="token punctuation">;</span>

	<span class="token comment"># ä¸‹é¢ç›´æ¥ç…§å†™</span>
	location / <span class="token punctuation">{</span>
    	try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.php<span class="token variable">$is_args</span><span class="token variable">$args</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	location ~ <span class="token punctuation">\</span>.php$ <span class="token punctuation">{</span>
        include fastcgi.conf<span class="token punctuation">;</span>
        include fastcgi_params<span class="token punctuation">;</span>
        fastcgi_pass php-fpm:9000<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>é…ç½®æˆåŠŸåé‡å¯ Nginx å®¹å™¨ï¼Œè®¿é—®æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œå¼€å§‹é…ç½® Typecho åšå®¢ç³»ç»Ÿã€‚</p>
<p><img src="https://img.seriouszyx.com/20210714235847.png#vwid=1920&amp;vhei=946"></p>
<p>æ•°æ®åº“é€‚é…å™¨é€‰æ‹©å®‰è£…å¥½çš„ <code>pdo-mysql</code> ï¼Œå› ä¸ºå·²ç»é…ç½®äº†è‡ªå®šä¹‰ Bridge ç½‘ç»œï¼Œæ•°æ®åº“åœ°å€å¡«å…¥å®¹å™¨åå³å¯è®¿é—®æ•°æ®åº“ã€‚</p>
<p><img src="https://img.seriouszyx.com/20210714235921.png#vwid=1920&amp;vhei=2145"></p>
<p>å®Œæˆé…ç½®ä¿¡æ¯åä¼šæ˜¾ç¤ºå¦‚ä¸‹ç•Œé¢ï¼Œéœ€è¦å¤åˆ¶æ–‡æœ¬æ¡†ä¸­çš„å†…å®¹ï¼Œç„¶ååˆ›å»º <code>config.inc.php</code> æ–‡ä»¶ç²˜è´´è¿›å»ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /data/solution/typecho/config.inc.php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://img.seriouszyx.com/20210714235946.png#vwid=1920&amp;vhei=781"></p>
<p>æœ€ç»ˆä¼šæ˜¾ç¤ºå®‰è£…æˆåŠŸé¡µé¢ï¼Œå¹¶å¯ä»¥æŸ¥çœ‹é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç ã€‚</p>
<p><img src="https://img.seriouszyx.com/20210715000019.png#vwid=1920&amp;vhei=944"></p>
<p>ä¸‹é¢ä¸¤ä¸ªé“¾æ¥åˆ†åˆ«æ˜¯åšå®¢é¡µé¢å’Œåå°æ§åˆ¶é¢æ¿ã€‚</p>
<p><img src="https://img.seriouszyx.com/20210715000053.png#vwid=1920&amp;vhei=1015"></p>
<p><img src="https://img.seriouszyx.com/20210715000124.png#vwid=1920&amp;vhei=950"></p>
<p>Typecho åšå®¢ç³»ç»Ÿè‡³æ­¤å®‰è£…å®Œæˆã€‚</p>
<hr>
<ol>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000021390958">Centos8 ä½¿ç”¨ docker è¿ç§» typecho åšå®¢</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/wudinaniya/article/details/105758739">å°† CentOS çš„ yum æºæ›´æ¢ä¸ºå›½å†…é•œåƒæº</a></li>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/docker/centos-docker-install.html">CentOS Docker å®‰è£…</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.dongxing.xin/pages/b1c12d/#php-%E5%AE%89%E8%A3%85">Typecho ç¯å¢ƒé…ç½®å’Œåšå®¢æ­å»º</a></li>
</ol>

  </div>
  </article>

  <div id="paginator">
    
  </div>

  </div>

</main>

<footer class="site-footer h-card">
  
  <div class="wrapper">
    <div class="footer-col-wrapper">
      <div class="footer-col">
        <ul class="contact-list">
          <li class="p-name"><a class="black-link" href="/">
                seriouszyx 
              </a></li></ul>
      </div>
    </div>
  </div>
  
    <div class="text-center">
      
        <span class="text-gray-300 text-sm" id="busuanzi_container_site_pv">
          æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
        </span>
      
      
        <span class="text-gray-300 text-sm">â€¢</span>
      
      
          <span class="text-gray-300 text-sm" id="busuanzi_container_site_uv">
            æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äººæ¬¡
          </span>
      
    </div>
  
  
    <div class="text-center">
      <a class="text-gray-300 text-sm" target="_blank" rel="noopener" href="https://beian.miit.gov.cn">è¾½ICPå¤‡19014015å·</a>
    </div>
  
</footer>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>


  <script async src="https://cdn.jsdelivr.net/gh/sukkaw/busuanzi@latest/bsz.pure.mini.js">
</script>


  <script src="https://cdn.jsdelivr.net/npm/tocbot@4.18.2/dist/tocbot.min.js"></script>

<script>
  var Star = window.Star || {};
  var CONFIG = {
    fancybox: true,
    tocbot: true
  };
  window.CONFIG = CONFIG;
</script>
<script src="/js/utils.js"></script>
<script src="/js/star.js"></script>

</body>
</html>
