<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.0.1" />
<meta property="og:title" content="ğŸ›¡ï¸ã€æ”»å‡»æ£€æµ‹ã€‘ç½‘ç»œæ‰«ææ¢æµ‹å·¥å…·çš„åˆ†æä¸è¯†åˆ«" />
<meta name="author" content="éšç§€" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="æ‰«ææ¢æµ‹å·¥å…·è¯†åˆ«" />
<meta property="og:description" content="æ‰«ææ¢æµ‹å·¥å…·è¯†åˆ«" />
<link rel="canonical" href="https://blog.seriouszyx.com/2021/scanner-analysis-and-detect.html" />
<meta property="og:url" content="https://blog.seriouszyx.com/2021/scanner-analysis-and-detect.html" />
<meta property="og:site_name" content="seriouszyxâ€™ Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-09-01T14:30:24+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ğŸ›¡ï¸ã€æ”»å‡»æ£€æµ‹ã€‘ç½‘ç»œæ‰«ææ¢æµ‹å·¥å…·çš„åˆ†æä¸è¯†åˆ«" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"éšç§€"},"dateModified":"2021-09-01T14:30:24+00:00","datePublished":"2021-09-01T14:30:24+00:00","description":"æ‰«ææ¢æµ‹å·¥å…·è¯†åˆ«","headline":"ğŸ›¡ï¸ã€æ”»å‡»æ£€æµ‹ã€‘ç½‘ç»œæ‰«ææ¢æµ‹å·¥å…·çš„åˆ†æä¸è¯†åˆ«","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.seriouszyx.com/2021/scanner-analysis-and-detect.html"},"url":"https://blog.seriouszyx.com/2021/scanner-analysis-and-detect.html"}</script>
<!-- End Jekyll SEO tag -->
<!-- local css -->
  <link rel="stylesheet" href="https://blog.seriouszyx.com/assets/css/main.css" />
  <link rel="shortcut icon" type="image/x-icon" href="/./favicon.ico" />
  <link rel="stylesheet" href="https://blog.seriouszyx.com/assets/css/grayscale.css" />
  <!-- docsearch -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" />
  <!-- utils -->
  <link href="https://unpkg.com/tailwindcss@^2/dist/utilities.min.css" rel="stylesheet">
</head>
<body>
    <main class="page-content" aria-label="Content">
        <div class="wrapper">
            <article
  class="post h-entry"
  id="post"
  itemscope
  itemtype="http://schema.org/BlogPosting"
>
  <head>
    <title>ğŸ›¡ï¸ã€æ”»å‡»æ£€æµ‹ã€‘ç½‘ç»œæ‰«ææ¢æµ‹å·¥å…·çš„åˆ†æä¸è¯†åˆ«</title>
  </head>
  <header class="post-header">
    <div class="post-back">
      <a class="black-link" href="https://blog.seriouszyx.com">
        â† Home
      </a>
    </div>

    <h1 class="post-title p-name" itemprop="name headline">
      ğŸ›¡ï¸ã€æ”»å‡»æ£€æµ‹ã€‘ç½‘ç»œæ‰«ææ¢æµ‹å·¥å…·çš„åˆ†æä¸è¯†åˆ«
    </h1>
    <p class="post-meta">
      <time
        class="dt-published"
        datetime="2021-09-01T14:30:24+00:00"
        itemprop="datePublished"
      >Sep 1, 2021
      </time><span class="busuanzi_container_page">
        <span id="busuanzi_container_page_pv">
          â€¢
          <span id="busuanzi_value_page_pv"></span> View
        </span>
      </span>
    </p>
  </header>

  



<ul>
  <li><a href="#æ‰«ææ¢æµ‹å·¥å…·è¯†åˆ«">æ‰«ææ¢æµ‹å·¥å…·è¯†åˆ«</a></li>
  <li><a href="#zmap">Zmap</a>
    <ul>
      <li><a href="#æŠ“åŒ…åˆ†æ">æŠ“åŒ…åˆ†æ</a></li>
      <li><a href="#æºç åˆ†æ">æºç åˆ†æ</a></li>
    </ul>
  </li>
  <li><a href="#angry-ip-scanner">Angry IP Scanner</a>
    <ul>
      <li><a href="#æŠ“åŒ…åˆ†æ-1">æŠ“åŒ…åˆ†æ</a></li>
      <li><a href="#æºç åˆ†æ-1">æºç åˆ†æ</a></li>
    </ul>
  </li>
  <li><a href="#masscan">Masscan</a>
    <ul>
      <li><a href="#æŠ“åŒ…åˆ†æ-2">æŠ“åŒ…åˆ†æ</a></li>
      <li><a href="#æºç åˆ†æ-2">æºç åˆ†æ</a></li>
    </ul>
  </li>
  <li><a href="#demo-è®¾è®¡ä¸å®ç°">Demo è®¾è®¡ä¸å®ç°</a></li>
</ul>


  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="æ‰«ææ¢æµ‹å·¥å…·è¯†åˆ«">æ‰«ææ¢æµ‹å·¥å…·è¯†åˆ«</h2>

<p>ç½‘ç»œæ‰«ææ¢æµ‹é€šå¸¸æ˜¯å‘èµ·ç½‘ç»œå…¥ä¾µçš„ç¬¬ä¸€æ­¥ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ‰«ææ¢æµ‹å·¥å…·è·å–ç½‘ç»œä¸­çš„ä¸»æœºç³»ç»Ÿã€TCP/UDP ç«¯å£çš„å¼€æ”¾æƒ…å†µã€å­åŸŸåã€ç½‘ç«™æŒ‡çº¹ã€WAFã€CDNã€ä¸­é—´ä»¶ç±»åˆ«ç­‰é‡è¦ä¿¡æ¯ï¼Œè¯†åˆ«å‡ºå­˜åœ¨å®‰å…¨æ¼æ´çš„ä¸»æœºæˆ–ç³»ç»Ÿï¼Œä»è€Œå‘èµ·æœ‰é’ˆå¯¹æ€§çš„ç½‘ç»œå…¥ä¾µè¡Œä¸ºã€‚æ­¤å¤–ï¼Œä¸€äº›æ‰«æå·¥å…·åŒæ—¶å…·å¤‡æ¼æ´åˆ©ç”¨çš„èƒ½åŠ›ã€‚å› æ­¤ï¼Œå¯¹ç½‘ç»œæ‰«ææ¢æµ‹è¡Œä¸ºè¿›è¡Œè¯†åˆ«å’Œç ”ç©¶ï¼Œæœ‰åˆ©äºåŠæ—¶å‘ç°ç½‘ç»œæ”»å‡»çš„å‰å…†ï¼Œå‘ç°ç½‘ç»œæ”»å‡»è¡Œä¸ºï¼Œå¿«é€Ÿå®šä½ç½‘ç»œæœåŠ¡ä¸­å­˜åœ¨çš„æ¼æ´ï¼Œå¯¹ç½‘ç»œå®‰å…¨é˜²æŠ¤å·¥ä½œååˆ†æœ‰æ„ä¹‰ã€‚</p>

<p>æœ¬æ–‡ä»¥ä¸‹åˆ—ä¸‰ä¸ªå¸¸è§æ‰«æå™¨ä¸ºä»£è¡¨ï¼Œæ¢ç©¶æ‰«æå™¨çš„ç‰¹æœ‰æŒ‡çº¹ä¿¡æ¯ï¼Œç¼–å†™ Demo è¿›è¡Œæ‰«æå™¨çš„è¯†åˆ«ã€‚</p>

<p><img src="https://img.seriouszyx.com/202109011044955.png#vwid=1999&amp;vhei=694" alt="" /></p>

<h2 id="zmap">Zmap</h2>

<h3 id="æŠ“åŒ…åˆ†æ">æŠ“åŒ…åˆ†æ</h3>

<p>ZMap è¢«è®¾è®¡ç”¨æ¥é’ˆå¯¹æ•´ä¸ª IPv4 åœ°å€ç©ºé—´æˆ–å…¶ä¸­çš„å¤§éƒ¨åˆ†å®æ–½ç»¼åˆæ‰«æçš„å·¥å…·ã€‚</p>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒZMap ä¼šå¯¹äºæŒ‡å®šç«¯å£å®æ–½å°½å¯èƒ½å¤§é€Ÿç‡çš„ TCP SYN æ‰«æã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå®¢æˆ·ç«¯åœ¨å‘é€ä¸€ä¸ª SYN åŒ…çš„æ—¶å€™ï¼Œå¦‚æœå¯¹æ–¹ç«¯å£å¼€æ”¾ï¼Œå°±ä¼šå‘é€ä¸€ä¸ª SYN-ACKï¼Œé‚£ä¹ˆå°±è¡¨æ˜è¿™ä¸ªç«¯å£å¼€æ”¾ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å‘é€ RST åŒ…ï¼Œé˜²æ­¢å ç”¨å¯¹æ–¹èµ„æºï¼›å¦‚æœå¯¹æ–¹ç«¯å£ä¸å¼€æ”¾ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¼šæ”¶åˆ°å¯¹æ–¹ä¸»æœºçš„ RST åŒ…ã€‚</p>

<p><img src="https://img.seriouszyx.com/202109011044047.png#vwid=2652&amp;vhei=1128" alt="" /></p>

<p>è¾ƒä¸ºä¿å®ˆçš„æƒ…å†µä¸‹ï¼Œå¯¹ 10,000 ä¸ªéšæœºçš„åœ°å€çš„ 80 ç«¯å£ä»¥ 10Mbps çš„é€Ÿåº¦æ‰«æï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<p><img src="https://img.seriouszyx.com/202109011044067.png#vwid=2225&amp;vhei=653" alt="" /></p>

<p>åœ¨ç”Ÿæˆçš„ csv ç»“æœæ–‡ä»¶ä¸­ï¼Œä»¥ä¸‹ IP åœ°å€çš„ 80 ç«¯å£å¼€æ”¾ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>47.243.139.246
20.205.204.152
121.36.193.65
156.245.39.71
13.238.233.150
142.234.31.240
68.183.75.244
185.48.122.237
52.25.116.123
104.127.1.181
185.248.102.245
95.217.201.8
3.125.24.134
23.15.117.202
</code></pre></div></div>

<p>æŠ“åŒ…ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼ŒZmap å‘éšæœºçš„ 10,000 ä¸ª IP çš„ 80 ç«¯å£å‘é€ SYN æ•°æ®åŒ…ã€‚</p>

<p><img src="https://img.seriouszyx.com/202109011044558.png#vwid=2560&amp;vhei=908" alt="" /></p>

<p>å¦‚æœ IP çš„ 80 ç«¯å£å¼€æ”¾ï¼Œä»¥ 47.243.139.246 ä¸ºä¾‹ï¼Œç­›é€‰å‡ºçš„æ•°æ®åŒ…å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…·ä½“è§£é‡Šä¸ºï¼š</p>

<ol>
  <li>å‘ 47.243.139.246 çš„ 80 ç«¯å£å‘é€ SYN æ•°æ®åŒ…</li>
  <li>æ¥æ”¶åˆ° 47.243.139.246 çš„ 80 ç«¯å£çš„ SYN/ACK åŒ…ï¼Œè¯æ˜è¯¥ IP çš„ 80 ç«¯å£å¯ç”¨</li>
  <li>å‘ 47.243.139.246 çš„ 80 ç«¯å£å‘é€ RST æ•°æ®åŒ…ï¼Œé˜²æ­¢å ç”¨å¯¹æ–¹èµ„æº</li>
</ol>

<p><img src="https://img.seriouszyx.com/202109011044591.png#vwid=2560&amp;vhei=371" alt="" /></p>

<p>å¦‚æœ IP çš„ 80 ç«¯å£ä¸å¼€æ”¾ï¼Œä»¥ 44.102.170.124 ä¸ºä¾‹ï¼Œç­›é€‰å‡ºçš„æ•°æ®åŒ…å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚Zmap å‘å…¶å‘é€ SYN è¯·æ±‚åæ²¡æœ‰å¾—åˆ°åº”ç­”ï¼Œæ•…åˆ¤æ–­è¯¥ IP çš„ 80 ç«¯å£ä¸å¯ç”¨ã€‚</p>

<p><img src="https://img.seriouszyx.com/202109011044623.png#vwid=2560&amp;vhei=235" alt="" /></p>

<p>æŸ¥çœ‹ Zmap å‘å“ªäº› IP å‘é€äº† RST æ•°æ®åŒ…ï¼Œåˆ™è¯æ˜è¿™äº› IP çš„ 80 ç«¯å£å¯ç”¨ã€‚ç­›é€‰ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç›®çš„åœ°å€ä¸ä¸Šè¿°çš„ csv ç»“æœæ–‡ä»¶ä¸€è‡´ã€‚</p>

<p><img src="https://img.seriouszyx.com/202109011044663.png#vwid=2560&amp;vhei=798" alt="" /></p>

<h3 id="æºç åˆ†æ">æºç åˆ†æ</h3>

<p>Zmap æ•´ä½“å‡½æ•°è°ƒç”¨å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚</p>

<p><img src="https://img.seriouszyx.com/202109011044692.png#vwid=942&amp;vhei=522" alt="" /></p>

<p>é€šè¿‡å›¾æˆ‘ä»¬å¯ä»¥ç›´è§‚çš„çœ‹åˆ°æ•´ä¸ªç¨‹åºè°ƒç”¨çš„è¿‡ç¨‹ã€‚Zmap åœ¨å¯åŠ¨æ—¶å€™ï¼Œå…ˆè·å–ç¯å¢ƒä¿¡æ¯ï¼Œå¦‚ IPã€ç½‘å…³ç­‰ã€‚ç„¶åè¯»å–é…ç½®æ–‡ä»¶é€‰æ‹©ä½¿ç”¨å“ªç§æ‰«ææ–¹å¼ï¼Œç„¶ååœ¨ Probe_modules åˆ‡æ¢åˆ°å¯¹åº”çš„æ¨¡å—ï¼Œç„¶åå¯åŠ¨ã€‚</p>

<p>ä¸‹é¢ä¾§é‡åˆ†æ SYN æ‰«æè¿™ä¸ªæ¨¡å—ï¼Œæ•´ä¸ªæ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹ä¸“é—¨è´Ÿè´£å‘é€ï¼Œå¦å¤–æœ‰ä¸€ä¸ªä½¿ç”¨ libpcap ç»„ä»¶æŠ“åŒ…ï¼Œå‘é€å’Œæ¥æ”¶å°±ç‹¬ç«‹å¼€æ¥ã€‚</p>

<p><a href="https://github.com/zmap/zmap/blob/main/src/probe_modules/module_tcp_synscan.c">zmap/src/probe_modules/module_tcp_synscan.c</a> æ˜¯ç”¨äºæ‰§è¡Œ TCP SYN æ‰«æçš„æ¢æµ‹æ¨¡å—ï¼Œåœ¨åˆå§‹åŒ–é˜¶æ®µçš„ synscan_init_perthread å‡½æ•°ä¸­ï¼Œä¾æ¬¡è°ƒç”¨ make_ip_header å‡½æ•°å’Œ make_tcp_header å‡½æ•°è¿›è¡Œæ•°æ®åŒ… header çš„å°è£…ã€‚</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="kt">int</span> <span class="nf">synscan_init_perthread</span><span class="p">(</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">macaddr_t</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="n">macaddr_t</span> <span class="o">*</span><span class="n">gw</span><span class="p">,</span>
    <span class="n">port_h_t</span> <span class="n">dst_port</span><span class="p">,</span>
    <span class="n">UNUSED</span> <span class="kt">void</span> <span class="o">**</span><span class="n">arg_ptr</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">ether_header</span> <span class="o">*</span><span class="n">eth_header</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ether_header</span> <span class="o">*</span><span class="p">)</span><span class="n">buf</span><span class="p">;</span>
    <span class="n">make_eth_header</span><span class="p">(</span><span class="n">eth_header</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">gw</span><span class="p">);</span>
    <span class="k">struct</span> <span class="n">ip</span> <span class="o">*</span><span class="n">ip_header</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ip</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">eth_header</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="kt">uint16_t</span> <span class="n">len</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">ip</span><span class="p">)</span> <span class="o">+</span> <span class="n">ZMAP_TCP_SYNSCAN_TCP_HEADER_LEN</span><span class="p">);</span>
    <span class="n">make_ip_header</span><span class="p">(</span><span class="n">ip_header</span><span class="p">,</span> <span class="n">IPPROTO_TCP</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
    <span class="k">struct</span> <span class="n">tcphdr</span> <span class="o">*</span><span class="n">tcp_header</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">tcphdr</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">ip_header</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">make_tcp_header</span><span class="p">(</span><span class="n">tcp_header</span><span class="p">,</span> <span class="n">dst_port</span><span class="p">,</span> <span class="n">TH_SYN</span><span class="p">);</span>
    <span class="n">set_mss_option</span><span class="p">(</span><span class="n">tcp_header</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è¿™ä¸¤ä¸ªå‡½æ•°ç¼–å†™äº <a href="https://github.com/zmap/zmap/blob/main/src/probe_modules/packet.c">zmap/src/probe_modules/packet.c</a> ä¸­ã€‚åˆ†æ make_ip_header å‡½æ•°å¯çŸ¥ï¼Œåœ¨ä¸‹ç¤ºç¬¬ 7 è¡Œï¼ŒIP çš„ identification number è¢«è®¾ç½®ä¸ºå›ºå®šçš„ 54321ã€‚</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">make_ip_header</span><span class="p">(</span><span class="k">struct</span> <span class="n">ip</span> <span class="o">*</span><span class="n">iph</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">protocol</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">ip_hl</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>  <span class="c1">// Internet Header Length</span>
    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">ip_v</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>   <span class="c1">// IPv4</span>
    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">ip_tos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// Type of Service</span>
    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">ip_len</span> <span class="o">=</span> <span class="n">len</span><span class="p">;</span>
    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">ip_id</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">54321</span><span class="p">);</span> <span class="c1">// identification number</span>
    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">ip_off</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>	   <span class="c1">// fragmentation flag</span>
    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">ip_ttl</span> <span class="o">=</span> <span class="n">MAXTTL</span><span class="p">;</span>      <span class="c1">// time to live (TTL)</span>
    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">ip_p</span> <span class="o">=</span> <span class="n">protocol</span><span class="p">;</span>      <span class="c1">// upper layer protocol =&gt; TCP</span>
    <span class="c1">// we set the checksum = 0 for now because that's</span>
    <span class="c1">// what it needs to be when we run the IP checksum</span>
    <span class="n">iph</span><span class="o">-&gt;</span><span class="n">ip_sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>åˆ†æ make_tcp_header å‡½æ•°å¯çŸ¥ï¼Œåœ¨ä¸‹ç¤ºç¬¬ 10 è¡Œï¼ŒTCP çš„ window è¢«è®¾ç½®ä¸ºå›ºå®šçš„ 65535ã€‚</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">make_tcp_header</span><span class="p">(</span><span class="k">struct</span> <span class="n">tcphdr</span> <span class="o">*</span><span class="n">tcp_header</span><span class="p">,</span> <span class="n">port_h_t</span> <span class="n">dest_port</span><span class="p">,</span>
		     <span class="kt">uint16_t</span> <span class="n">th_flags</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">tcp_header</span><span class="o">-&gt;</span><span class="n">th_seq</span> <span class="o">=</span> <span class="n">random</span><span class="p">();</span>
    <span class="n">tcp_header</span><span class="o">-&gt;</span><span class="n">th_ack</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">tcp_header</span><span class="o">-&gt;</span><span class="n">th_x2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">tcp_header</span><span class="o">-&gt;</span><span class="n">th_off</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">// data offset</span>
    <span class="n">tcp_header</span><span class="o">-&gt;</span><span class="n">th_flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">tcp_header</span><span class="o">-&gt;</span><span class="n">th_flags</span> <span class="o">|=</span> <span class="n">th_flags</span><span class="p">;</span>
    <span class="n">tcp_header</span><span class="o">-&gt;</span><span class="n">th_win</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mi">65535</span><span class="p">);</span> <span class="c1">// largest possible window</span>
    <span class="n">tcp_header</span><span class="o">-&gt;</span><span class="n">th_sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">tcp_header</span><span class="o">-&gt;</span><span class="n">th_urp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">tcp_header</span><span class="o">-&gt;</span><span class="n">th_dport</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">dest_port</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æŸ¥çœ‹æŠ“å–çš„ SYN æ•°æ®åŒ…ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒIP çš„ ID å’Œ TCP çš„ window ç¡®å®ä¸º 54321 å’Œ 65535ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªå›ºå®šå€¼å¯ä½œä¸ºæ‰«æå™¨ç‰¹å¾ã€‚</p>

<p><img src="https://img.seriouszyx.com/202109011044714.png#vwid=2560&amp;vhei=1275" alt="" /></p>

<h2 id="angry-ip-scanner">Angry IP Scanner</h2>

<h3 id="æŠ“åŒ…åˆ†æ-1">æŠ“åŒ…åˆ†æ</h3>

<p>Angry IP Scannerï¼ˆç®€ç§° angryipï¼‰ æ˜¯ä¸€æ¬¾å¼€æºè·¨å¹³å°çš„ç½‘ç»œæ‰«æå™¨ï¼Œä¸»è¦ç”¨äºæ‰«æ IP åœ°å€å’Œç«¯å£ã€‚</p>

<p>angryip é»˜è®¤ä½¿ç”¨ Windows ICMP æ–¹æ³•æ‰«æå„ä¸ª ip åœ°å€ï¼Œæ‰«ææ¯ä¸ª IP çš„ 80ã€443 å’Œ 8080 ç«¯å£ã€‚ä»¥ IP èŒƒå›´ 123.56.104.200~123.56.104.250 ä¸ºä¾‹ï¼Œæ‰«æç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œçº¢è‰²ä»£è¡¨ IP ä¸å¯ç”¨ï¼Œè“è‰²ä»£è¡¨ IP å¯ç”¨ç«¯å£ä¸å¯ç”¨ï¼Œç»¿è‰²ä»£è¡¨ IP å’Œç«¯å£å‡å¯ç”¨ã€‚</p>

<p><img src="https://img.seriouszyx.com/202109011044740.png#vwid=2558&amp;vhei=1534" alt="" /></p>

<p>åœ¨æ•è·çš„æ•°æ®åŒ…ä¸­ï¼Œä»¥ 123.56.104.218 ä¸ºä¾‹ï¼Œè¯¥ IP è¢«æ ‡è®°ä¸ºç»¿è‰²ï¼Œä¸‹é¢æ˜¯ä¸å®ƒæœ‰å…³çš„æ•°æ®åŒ…æŠ“å–ç»“æœã€‚</p>

<p>å›¾ä¸­ç¬¬ä¸€ä¸ªçº¢æ¡†å¤„ angryip ä¸ 123.56.104.218 è¿›è¡Œäº† 3 æ¬¡ pingï¼Œä¸”éƒ½äºˆä»¥å›å¤ï¼Œè¯´æ˜è¯¥ IP å¯ç”¨ã€‚ç¬¬äºŒä¸ªçº¢æ¡†å¤„ angryip åˆ†åˆ«æµ‹è¯• 123.56.104.218 çš„ 80ã€443 å’Œ 8080 ç«¯å£ï¼Œå…¶ä¸­ 80 å’Œ 443 ç«¯å£äºˆä»¥å›å¤ï¼Œè¯´æ˜è¿™ä¸¤ä¸ªç«¯å£å¯ç”¨ã€‚</p>

<p><img src="https://img.seriouszyx.com/202109011044760.png#vwid=2560&amp;vhei=930" alt="" /></p>

<p>åœ¨ä¸å¯ç”¨çš„ IP ä¸­ï¼Œä»¥ 123.56.104.204 ä¸ºä¾‹ï¼Œä¸å®ƒç›¸å…³çš„æ•°æ®åŒ…æŠ“å–ç»“æœå¦‚ä¸‹ã€‚angryip å‘å…¶å‘é€ 3 æ¬¡ ping è¯·æ±‚ï¼Œéƒ½æ²¡æœ‰å¾—åˆ°å›å¤ï¼Œåˆ™åˆ¤æ–­å…¶ IP ä¸å¯ç”¨ï¼Œä¹Ÿæ²¡æœ‰å‘å…¶ç«¯å£å‘é€æ•°æ®åŒ…ã€‚</p>

<p><img src="https://img.seriouszyx.com/202109011044783.png#vwid=2560&amp;vhei=325" alt="" /></p>

<h3 id="æºç åˆ†æ-1">æºç åˆ†æ</h3>

<p>å› ä¸ºæ— è®º IP å’Œç«¯å£æ˜¯å¦å¯ç”¨ï¼Œangryip éƒ½ä¼šå…ˆå‘é€ ping æ•°æ®åŒ…ï¼Œæ‰€ä»¥é€šè¿‡ ping é˜¶æ®µçš„æºç åˆ†æå…¶å·¥å…·çš„ç‰¹å¾ã€‚</p>

<p>åˆ†æ <a href="https://github.com/angryip/ipscan/blob/64ec7090acdba380a62d5d2e1a6c630cc5302197/test/net/azib/ipscan/core/net/ICMPSharedPingerTest.java">ipscan/test/net/azib/ipscan/core/net/ICMPSharedPingerTest.java</a> æºç ï¼Œè¯¥æµ‹è¯•ç±»è°ƒç”¨ pinger.ping()æ–¹æ³• 3 æ¬¡ï¼Œå¹¶è®¡ç®—å¹³å‡æ—¶é•¿ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ICMPSharedPingerTest</span> <span class="o">{</span>
    <span class="nd">@Test</span> <span class="nd">@Ignore</span><span class="o">(</span><span class="s">"this test works only under root"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testPing</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
	<span class="nc">Pinger</span> <span class="n">pinger</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ICMPSharedPinger</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
	<span class="nc">PingResult</span> <span class="n">result</span> <span class="o">=</span> <span class="n">pinger</span><span class="o">.</span><span class="na">ping</span><span class="o">(</span><span class="k">new</span> <span class="nc">ScanningSubject</span><span class="o">(</span><span class="nc">InetAddress</span><span class="o">.</span><span class="na">getLocalHost</span><span class="o">()),</span> <span class="mi">3</span><span class="o">);</span>
	<span class="n">assertTrue</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getAverageTime</span><span class="o">()</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">);</span>
	<span class="n">assertTrue</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getAverageTime</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="o">);</span>
	<span class="n">assertTrue</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getTTL</span><span class="o">()</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>è¯¥æ–¹æ³•åœ¨ <a href="https://github.com/angryip/ipscan/blob/master/src/net/azib/ipscan/core/net/WindowsPinger.java">ipscan/test/net/azib/ipscan/core/net/WindowsPinger.java</a> ä¸­ï¼Œæºç å¦‚ä¸‹æ‰€ç¤ºï¼Œåˆ¤æ–­ IP ç±»å‹ï¼Œå¹¶è°ƒç”¨ IPv6 å’Œ IPv4 å¯¹åº”çš„æ–¹æ³•ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">PingResult</span> <span class="nf">ping</span><span class="o">(</span><span class="nc">ScanningSubject</span> <span class="n">subject</span><span class="o">,</span> <span class="kt">int</span> <span class="n">count</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">subject</span><span class="o">.</span><span class="na">isIPv6</span><span class="o">())</span>
	<span class="k">return</span> <span class="nf">ping6</span><span class="o">(</span><span class="n">subject</span><span class="o">,</span> <span class="n">count</span><span class="o">);</span>
    <span class="k">else</span>
	<span class="k">return</span> <span class="nf">ping4</span><span class="o">(</span><span class="n">subject</span><span class="o">,</span> <span class="n">count</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ä»¥ IPv4 ä¸ºä¾‹ï¼Œæ–¹æ³•ä¸­å®šä¹‰äº†æ•°æ®åŒ…çš„æ•°æ®å¤§å°ä¸º 32ï¼Œå³ sendDataSize = 32ã€‚åç»­ä½¿ç”¨ Memory()æ–¹æ³•åˆ›å»º SendData å¯¹è±¡ï¼Œå¹¶æœªå¯¹å…¶è¿›è¡Œèµ‹å€¼ï¼Œæ•…é»˜è®¤å€¼åº”å…¨ä¸º 0ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="nc">PingResult</span> <span class="nf">ping4</span><span class="o">(</span><span class="nc">ScanningSubject</span> <span class="n">subject</span><span class="o">,</span> <span class="kt">int</span> <span class="n">count</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="nc">Pointer</span> <span class="n">handle</span> <span class="o">=</span> <span class="n">dll</span><span class="o">.</span><span class="na">IcmpCreateFile</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">handle</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">IOException</span><span class="o">(</span><span class="s">"Unable to create Windows native ICMP handle"</span><span class="o">);</span>

    <span class="kt">int</span> <span class="n">sendDataSize</span> <span class="o">=</span> <span class="mi">32</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">replyDataSize</span> <span class="o">=</span> <span class="n">sendDataSize</span> <span class="o">+</span> <span class="o">(</span><span class="k">new</span> <span class="nc">IcmpEchoReply</span><span class="o">().</span><span class="na">size</span><span class="o">())</span> <span class="o">+</span> <span class="mi">10</span><span class="o">;</span>
    <span class="nc">Pointer</span> <span class="n">sendData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Memory</span><span class="o">(</span><span class="n">sendDataSize</span><span class="o">);</span>
    <span class="n">sendData</span><span class="o">.</span><span class="na">clear</span><span class="o">(</span><span class="n">sendDataSize</span><span class="o">);</span>
    <span class="nc">Pointer</span> <span class="n">replyData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Memory</span><span class="o">(</span><span class="n">replyDataSize</span><span class="o">);</span>

    <span class="nc">PingResult</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PingResult</span><span class="o">(</span><span class="n">subject</span><span class="o">.</span><span class="na">getAddress</span><span class="o">(),</span> <span class="n">count</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
	<span class="nc">IpAddrByVal</span> <span class="n">ipaddr</span> <span class="o">=</span> <span class="n">toIpAddr</span><span class="o">(</span><span class="n">subject</span><span class="o">.</span><span class="na">getAddress</span><span class="o">());</span>
	<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">count</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">currentThread</span><span class="o">().</span><span class="na">isInterrupted</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">numReplies</span> <span class="o">=</span> <span class="n">dll</span><span class="o">.</span><span class="na">IcmpSendEcho</span><span class="o">(</span><span class="n">handle</span><span class="o">,</span> <span class="n">ipaddr</span><span class="o">,</span> <span class="n">sendData</span><span class="o">,</span> <span class="o">(</span><span class="kt">short</span><span class="o">)</span> <span class="n">sendDataSize</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">replyData</span><span class="o">,</span> <span class="n">replyDataSize</span><span class="o">,</span> <span class="n">timeout</span><span class="o">);</span>
	    <span class="nc">IcmpEchoReply</span> <span class="n">echoReply</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">IcmpEchoReply</span><span class="o">(</span><span class="n">replyData</span><span class="o">);</span>
	    <span class="k">if</span> <span class="o">(</span><span class="n">numReplies</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">echoReply</span><span class="o">.</span><span class="na">status</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">echoReply</span><span class="o">.</span><span class="na">address</span><span class="o">.</span><span class="na">bytes</span><span class="o">,</span> <span class="n">ipaddr</span><span class="o">.</span><span class="na">bytes</span><span class="o">))</span> <span class="o">{</span>
		<span class="n">result</span><span class="o">.</span><span class="na">addReply</span><span class="o">(</span><span class="n">echoReply</span><span class="o">.</span><span class="na">roundTripTime</span><span class="o">);</span>
		<span class="n">result</span><span class="o">.</span><span class="na">setTTL</span><span class="o">(</span><span class="n">echoReply</span><span class="o">.</span><span class="na">options</span><span class="o">.</span><span class="na">ttl</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="o">);</span>
	    <span class="o">}</span>
	<span class="o">}</span>
    <span class="o">}</span>
    <span class="k">finally</span> <span class="o">{</span>
	<span class="n">dll</span><span class="o">.</span><span class="na">IcmpCloseHandle</span><span class="o">(</span><span class="n">handle</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>åœ¨å®é™…æŠ“åŒ…ä¸­ï¼Œæ¯ä¸ªå‘å‡ºçš„ ICMP è¯·æ±‚ä¸­ï¼ŒData çš„å¤§å°å‡ä¸º 32 å­—èŠ‚ï¼Œä¸”å…¨ä¸º 0ï¼Œæ‰€ä»¥å¯å°†å®ƒä½œä¸º angryip çš„ç‰¹å¾ã€‚</p>

<p><img src="https://img.seriouszyx.com/202109011044806.png#vwid=2560&amp;vhei=1068" alt="" /></p>

<h2 id="masscan">Masscan</h2>

<h3 id="æŠ“åŒ…åˆ†æ-2">æŠ“åŒ…åˆ†æ</h3>

<p>Masscan é»˜è®¤ä½¿ç”¨ SYN æ‰«æï¼Œä»¥ IP 123.56.104.218 ä¸ºä¾‹ï¼Œæ‰«æå…¶ 1~600 ç«¯å£ï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºã€‚</p>

<p><img src="https://img.seriouszyx.com/202109011044826.png#vwid=1346&amp;vhei=278" alt="" /></p>

<p>æŠ“åŒ…ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼ŒMasscan å‘ 123.56.104.218 çš„ 1~600 ç«¯å£è¿›è¡ŒéšæœºåŒ–æ‰«æï¼Œå‘å‡º SYN è¯·æ±‚ã€‚</p>

<p><img src="https://img.seriouszyx.com/202109011044847.png#vwid=2560&amp;vhei=1250" alt="" /></p>

<p>æŸ¥çœ‹ 80 ç«¯å£çš„æ•°æ®åŒ…ï¼Œä¸‹å›¾å¯çŸ¥ 80 ç«¯å£å‘ Masscan å›å¤ï¼Œè¯´æ˜è¯¥ç«¯å£å¯ç”¨ã€‚</p>

<p><img src="https://img.seriouszyx.com/202109011044871.png#vwid=2560&amp;vhei=277" alt="" /></p>

<p>æŸ¥çœ‹ 81 ç«¯å£çš„æ•°æ®åŒ…ï¼Œå‘ç°å¹¶æ²¡æœ‰æ•°æ®åŒ…å›å¤ï¼Œè¯´æ˜è¯¥ç«¯å£ä¸å¯ç”¨ã€‚</p>

<p><img src="https://img.seriouszyx.com/202109011044891.png#vwid=2560&amp;vhei=162" alt="" /></p>

<p>ç­›é€‰æ”¶åˆ°çš„ SYN/ACK æ•°æ®åŒ…ï¼Œå¾—åˆ° 22ã€443 å’Œ 80 ç«¯å£ï¼Œè¯´æ˜ 123.56.104.218 çš„ 1~600 ä¸­è¿™ 3 ä¸ªç«¯å£å¯ç”¨ã€‚</p>

<p><img src="https://img.seriouszyx.com/202109011044912.png#vwid=2560&amp;vhei=260" alt="" /></p>

<h3 id="æºç åˆ†æ-2">æºç åˆ†æ</h3>

<p>è§‚å¯ŸæŠ“åŒ…åˆ†æä¸­ç»“æœå¯ä»¥å‘ç°ï¼Œæ‰€æœ‰å‘å‡ºçš„ SYN è¯·æ±‚ä¸­ï¼Œçª—å£å¤§å°éƒ½æ˜¯ 1024ã€‚</p>

<p><img src="https://img.seriouszyx.com/202109011044935.png#vwid=2560&amp;vhei=1250" alt="" /></p>

<p>åœ¨ Masscan çš„ä¸»å‡½æ•° <a href="https://github.com/robertdavidgraham/masscan/blob/master/src/main.c">masscan/src/main.c</a> æ–‡ä»¶ä¸­ï¼Œé»˜è®¤ä½¿ç”¨ä»¥ä¸‹ä»£ç åˆå§‹åŒ– TCP æ•°æ®åŒ…çš„æ¨¡æ¿ã€‚</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">template_packet_init</span><span class="p">(</span>
    <span class="n">parms</span><span class="o">-&gt;</span><span class="n">tmplset</span><span class="p">,</span>
    <span class="n">parms</span><span class="o">-&gt;</span><span class="n">source_mac</span><span class="p">,</span>
    <span class="n">parms</span><span class="o">-&gt;</span><span class="n">router_mac_ipv4</span><span class="p">,</span>
    <span class="n">parms</span><span class="o">-&gt;</span><span class="n">router_mac_ipv6</span><span class="p">,</span>
    <span class="n">masscan</span><span class="o">-&gt;</span><span class="n">payloads</span><span class="p">.</span><span class="n">udp</span><span class="p">,</span>
    <span class="n">masscan</span><span class="o">-&gt;</span><span class="n">payloads</span><span class="p">.</span><span class="n">oproto</span><span class="p">,</span>
    <span class="n">stack_if_datalink</span><span class="p">(</span><span class="n">masscan</span><span class="o">-&gt;</span><span class="n">nic</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">adapter</span><span class="p">),</span>
    <span class="n">masscan</span><span class="o">-&gt;</span><span class="n">seed</span><span class="p">);</span>
</code></pre></div></div>

<p>è¯¥å‡½æ•°ä½äº <a href="https://github.com/robertdavidgraham/masscan/blob/master/src/templ-pkt.c">masscan/src/templ.pkt.c</a> ä¸­ï¼Œå…¶ä¸­å¯¹äº TCP çš„åˆå§‹åŒ–ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* [TCP] */</span>
<span class="n">_template_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">templset</span><span class="o">-&gt;</span><span class="n">pkts</span><span class="p">[</span><span class="n">Proto_TCP</span><span class="p">],</span>
               <span class="n">source_mac</span><span class="p">,</span> <span class="n">router_mac_ipv4</span><span class="p">,</span> <span class="n">router_mac_ipv6</span><span class="p">,</span>
               <span class="n">default_tcp_template</span><span class="p">,</span>
               <span class="k">sizeof</span><span class="p">(</span><span class="n">default_tcp_template</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">data_link</span><span class="p">);</span>
<span class="n">templset</span><span class="o">-&gt;</span><span class="n">count</span><span class="o">++</span><span class="p">;</span>
</code></pre></div></div>

<p>å…¶ä¸­è°ƒç”¨çš„ default_tcp_template å®šä¹‰åœ¨è¯¥æ–‡ä»¶å¤´éƒ¨ï¼Œä¸‹è¿° 7 è¡ŒæŒ‡å®š IP çš„ length ä¸º 40ï¼Œä¸‹è¿° 10 è¡ŒæŒ‡å®š TLL ä¸º 255ï¼Œä¸‹è¿° 18 è¡ŒæŒ‡å®š ack ä¸º 0ï¼Œä¸‹è¿° 21 è¡ŒæŒ‡å®š window çš„å¤§å°ä¸º 1024ï¼Œå¯ä»¥å°†è¿™äº›æŒ‡æ ‡è§†ä¸º Masscan çš„ç‰¹å¾ã€‚</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">default_tcp_template</span><span class="p">[]</span> <span class="o">=</span>
    <span class="s">"</span><span class="se">\0\1\2\3\4\5</span><span class="s">"</span>  <span class="cm">/* Ethernet: destination */</span>
    <span class="s">"</span><span class="se">\6\7</span><span class="s">\x8\x9\xa\xb"</span>  <span class="cm">/* Ethernet: source */</span>
    <span class="s">"</span><span class="se">\x08\x00</span><span class="s">"</span>      <span class="cm">/* Ethernet type: IPv4 */</span>
    <span class="s">"</span><span class="se">\x45</span><span class="s">"</span>          <span class="cm">/* IP type */</span>
    <span class="s">"</span><span class="se">\x00</span><span class="s">"</span>
    <span class="s">"</span><span class="se">\x00\x28</span><span class="s">"</span>      <span class="cm">/* total length = 40 bytes */</span>
    <span class="s">"</span><span class="se">\x00\x00</span><span class="s">"</span>      <span class="cm">/* identification */</span>
    <span class="s">"</span><span class="se">\x00\x00</span><span class="s">"</span>      <span class="cm">/* fragmentation flags */</span>
    <span class="s">"</span><span class="se">\xFF\x06</span><span class="s">"</span>      <span class="cm">/* TTL=255, proto=TCP */</span>
    <span class="s">"</span><span class="se">\xFF\xFF</span><span class="s">"</span>      <span class="cm">/* checksum */</span>
    <span class="s">"</span><span class="se">\0\0\0\0</span><span class="s">"</span>      <span class="cm">/* source address */</span>
    <span class="s">"</span><span class="se">\0\0\0\0</span><span class="s">"</span>      <span class="cm">/* destination address */</span>

    <span class="s">"</span><span class="se">\0\0</span><span class="s">"</span>          <span class="cm">/* source port */</span>
    <span class="s">"</span><span class="se">\0\0</span><span class="s">"</span>          <span class="cm">/* destination port */</span>
    <span class="s">"</span><span class="se">\0\0\0\0</span><span class="s">"</span>      <span class="cm">/* sequence number */</span>
    <span class="s">"</span><span class="se">\0\0\0\0</span><span class="s">"</span>      <span class="cm">/* ack number */</span>
    <span class="s">"</span><span class="se">\x50</span><span class="s">"</span>          <span class="cm">/* header length */</span>
    <span class="s">"</span><span class="se">\x02</span><span class="s">"</span>          <span class="cm">/* SYN */</span>
    <span class="s">"</span><span class="se">\x04</span><span class="s">\x0"</span>        <span class="cm">/* window fixed to 1024 */</span>
    <span class="s">"</span><span class="se">\xFF\xFF</span><span class="s">"</span>      <span class="cm">/* checksum */</span>
    <span class="s">"</span><span class="se">\x00\x00</span><span class="s">"</span>      <span class="cm">/* urgent pointer */</span>
    <span class="s">"</span><span class="se">\x02\x04\x05\xb4</span><span class="s">"</span>  <span class="cm">/* added options [mss 1460] */</span>
<span class="p">;</span>
</code></pre></div></div>

<h2 id="demo-è®¾è®¡ä¸å®ç°">Demo è®¾è®¡ä¸å®ç°</h2>

<p>ç»è¿‡æŠ“åŒ…åˆ†æå’Œæºç åˆ†æåï¼Œå¯ä»¥æ€»ç»“ä¸‰ä¸ªæ‰«æå™¨çš„ç‰¹å¾å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚</p>

<p><img src="https://img.seriouszyx.com/202109011044988.png#vwid=1524&amp;vhei=877" alt="" /></p>

<p>æ€»ä½“æ¥çœ‹ï¼Œä¸‰ä¸ªæ‰«æå™¨å·¥å…·éƒ½æ˜¯åŸºäºå•åŒ…çš„å¤´éƒ¨ä¿¡æ¯è¿›è¡Œè¯†åˆ«ï¼Œä¸”ç»è¿‡æºç ç¡®è®¤ï¼Œå±äºå¼ºç‰¹å¾ã€‚é‚£ä¹ˆè¯†åˆ«çš„å…·ä½“è®¾è®¡ä¹Ÿå°±å¾ˆå®¹æ˜“äº†ï¼Œå¯¹ pcap æ–‡ä»¶çš„æ¯ä¸ªæ•°æ®åŒ…è¿›è¡Œåˆ†ç±»ï¼Œåˆ¤æ–­å…¶æ˜¯å¦æ»¡è¶³ä¸Šè¿°ä¸‰ä¸ªæŒ‡çº¹ï¼Œæ ¸å¿ƒè¯†åˆ«æµç¨‹å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>

<p><img src="https://img.seriouszyx.com/202109011044015.png#vwid=622&amp;vhei=624" alt="" /></p>

<p>å…·ä½“å®ç°ä½¿ç”¨ Python çš„ Scrapy åŒ…è§£æ pcapï¼Œè¿›è¡Œç›¸å…³æ“ä½œï¼Œä»£ç å¾ˆçŸ­ï¼Œæ ¸å¿ƒéƒ¨åˆ†å¦‚ä¸‹ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">packets</span><span class="p">:</span>
    <span class="k">if</span> <span class="s">'TCP'</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="c1"># è¯†åˆ« Zmap
</span>        <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'TCP'</span><span class="p">].</span><span class="n">window</span> <span class="o">==</span> <span class="mi">65535</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'IP'</span><span class="p">].</span><span class="nb">id</span> <span class="o">==</span> <span class="mi">54321</span><span class="p">):</span>
            <span class="n">isZmap</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c1"># è¯†åˆ« Masscan
</span>        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">'TCP'</span><span class="p">].</span><span class="n">window</span> <span class="o">==</span> <span class="mi">1024</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s">'TCP'</span><span class="p">].</span><span class="n">ack</span> <span class="o">==</span> <span class="mi">0</span> \
                <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s">'IP'</span><span class="p">].</span><span class="n">ttl</span> <span class="o">==</span> <span class="mi">255</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s">'IP'</span><span class="p">].</span><span class="nb">len</span> <span class="o">==</span> <span class="mi">40</span><span class="p">:</span>
            <span class="n">isMasscan</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="c1"># è¯†åˆ« Angry IP Scanner
</span>    <span class="k">if</span> <span class="s">'ICMP'</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">'Raw'</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">processStr</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'Raw'</span><span class="p">].</span><span class="n">load</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'Raw'</span><span class="p">])</span> <span class="o">==</span> <span class="mi">32</span> <span class="ow">and</span> <span class="n">items</span> <span class="o">==</span> <span class="n">ANGRYIP_FLAG</span><span class="p">:</span>
                <span class="n">isAngryip</span> <span class="o">=</span> <span class="bp">True</span>
</code></pre></div></div>

<p>ä»£ç æ”¾ç½®äº <a href="https://github.com/seriouszyx/ScannerRecognition">GitHub</a>ã€‚</p>

<hr />

<p>å‚è€ƒï¼š</p>

<p><a href="https://linux.cn/article-5860-1.html">äº’è”ç½‘æ‰«æå™¨ ZMap å®Œå…¨æ‰‹å†Œ</a></p>

<p><a href="https://nanshihui.github.io/2017/03/29/zmap%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB%E4%B9%8Bzmap%E6%89%AB%E6%8F%8F%E5%BF%AB%E7%9A%84%E5%8E%9F%E5%9B%A0/">zmap æºç è§£è¯»ä¹‹ zmap æ‰«æå¿«çš„åŸå› </a></p>

<p><a href="https://github.com/al0ne/Nmap_Bypass_IDS">Nmap_Bypass_IDS</a></p>

<p><a href="https://blog.csdn.net/weixin_44288604/article/details/115656891">å…¥ä¾µæ£€æµ‹â€”â€”masscan(æ‰«æç¯‡)</a></p>

  </div>

  <a class="u-url" href="/2021/scanner-analysis-and-detect.html" hidden></a>
</article>

<div class="ant-alert mb-0">
  <ul>
    <li>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡é‡‡ç”¨<a target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">çŸ¥è¯†å…±äº« 3.0 è®¸å¯è¯</a> (<strong>ä¿æŒç½²å</strong>-è‡ªç”±è½¬è½½-éå•†ç”¨-éè¡ç”Ÿ)</li>
    <li>å‘è¡¨äº 2021-09-01
    </li>
  </ul>
  
</div>

<div class="page-navigation">
  
  <a class="prev" href="/2021/publish-to-maven.html">&laquo; ä¸Šä¸€ç¯‡</a>
   
  <a class="next" href="/2021/deploy-typecho-blog.html">ä¸‹ä¸€ç¯‡ &raquo;</a>
  
</div><div id="gitalk-container">
</div>
<script>
    var gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        repo: 'blog',
        owner: 'imageslr',
        admin: ['imageslr'],
        id: md5(location.pathname),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false,  // Facebook-like distraction free mode
        createIssueManually: true,
        pagerDirection: "first",
        perPage: 25,
    })
    gitalk.render('gitalk-container')
</script>
        </div>
    </main><footer class="site-footer h-card">
    <data class="u-url" href="/"></data>
    <div class="wrapper">
      <div class="footer-col-wrapper">
        <div class="footer-col">
          <ul class="contact-list">
            <li class="p-name"><a class="black-link" href="https://blog.seriouszyx.com/about.html">
                  éšç§€ 
                </a></li><li>
              <a class="u-email black-link" href="mailto:seriouszyx@gmail.com">seriouszyx@gmail.com</a></li></ul>
        </div>
      </div>
    </div>
    <div class="text-center">
      <a class="text-gray-300 text-sm" href="https://beian.miit.gov.cn">è¾½ICPå¤‡19014015å·</a>
    </div>
  </footer>

  <!-- highlight js -->
  <script src="https://cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-chtml.js"></script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } });
  </script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        processEscapes: true
      }
    });
  </script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><!-- gitalk --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script>
  <script src="/assets/js/md5.min.js"></script><!-- viewerjs -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/viewerjs@1.10.4/dist/viewer.min.css">
  <script src="https://cdn.jsdelivr.net/npm/viewerjs@1.10.4/dist/viewer.min.js"></script>
  <script>
    var el = document.getElementById('post');
    if (el) new Viewer(el);
  </script>

  
  <!-- google analytics --><link type="application/atom+xml" rel="alternate" href="https://blog.seriouszyx.com/feed.xml" title="seriouszyx' Blog" /><script>
  (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();
  </script></body>
</html>