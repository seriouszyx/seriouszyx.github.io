













<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>ğŸ›¡ï¸ã€æ”»å‡»æ£€æµ‹ã€‘ç½‘ç»œæ‰«ææ¢æµ‹å·¥å…·çš„åˆ†æä¸è¯†åˆ« [ éšç§€ ]</title>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prism-themes@1.9.0/themes/prism-one-light.min.css">
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  

  <link rel="stylesheet" href="/css/third_party/utilities.min.css">
  <link rel="stylesheet" href="/css/star.css">
<meta name="generator" content="Hexo 6.1.0"></head>
<body>

<main class="page-content" aria-label="Content">
  

  <div class="wrapper">
    
    
  <article 
    class="post h-entry"
    id="post"
    itemscope
    itemtype="http://schema.org/BlogPosting"
  >

  <header class="post-header">
    <div class="post-back">
      <a class="black-link" href="/">
        â† Home
      </a>
    </div>

    <h1 class="post-title p-name" itemprop="name headline">
      ğŸ›¡ï¸ã€æ”»å‡»æ£€æµ‹ã€‘ç½‘ç»œæ‰«ææ¢æµ‹å·¥å…·çš„åˆ†æä¸è¯†åˆ«
    </h1>
    <p class="post-meta">
      <time
        class="dt-published"
        datetime="1630477824000"
        itemprop="datePublished"
      >
        Sep 01, 2021
      </time>â€¢
      <span itemprop="author" itemscope itemtype="http://schema.org/Person"
        ><span class="p-author h-card" itemprop="name"
          >seriouszyx</span
        ></span
      >
        <span class="busuanzi_container_page">
          <span id="busuanzi_container_page_pv">
            â€¢
          <span id="busuanzi_value_page_pv"></span> View
          </span>
        </span>
      
    </p>
  </header>

  <div class="js-toc"></div>

  <div class="post-content" itemprop="articleBody">
    <h2 id="æ‰«ææ¢æµ‹å·¥å…·è¯†åˆ«"><a href="#æ‰«ææ¢æµ‹å·¥å…·è¯†åˆ«" class="headerlink" title="æ‰«ææ¢æµ‹å·¥å…·è¯†åˆ«"></a>æ‰«ææ¢æµ‹å·¥å…·è¯†åˆ«</h2><p>ç½‘ç»œæ‰«ææ¢æµ‹é€šå¸¸æ˜¯å‘èµ·ç½‘ç»œå…¥ä¾µçš„ç¬¬ä¸€æ­¥ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ‰«ææ¢æµ‹å·¥å…·è·å–ç½‘ç»œä¸­çš„ä¸»æœºç³»ç»Ÿã€TCP/UDP ç«¯å£çš„å¼€æ”¾æƒ…å†µã€å­åŸŸåã€ç½‘ç«™æŒ‡çº¹ã€WAFã€CDNã€ä¸­é—´ä»¶ç±»åˆ«ç­‰é‡è¦ä¿¡æ¯ï¼Œè¯†åˆ«å‡ºå­˜åœ¨å®‰å…¨æ¼æ´çš„ä¸»æœºæˆ–ç³»ç»Ÿï¼Œä»è€Œå‘èµ·æœ‰é’ˆå¯¹æ€§çš„ç½‘ç»œå…¥ä¾µè¡Œä¸ºã€‚æ­¤å¤–ï¼Œä¸€äº›æ‰«æå·¥å…·åŒæ—¶å…·å¤‡æ¼æ´åˆ©ç”¨çš„èƒ½åŠ›ã€‚å› æ­¤ï¼Œå¯¹ç½‘ç»œæ‰«ææ¢æµ‹è¡Œä¸ºè¿›è¡Œè¯†åˆ«å’Œç ”ç©¶ï¼Œæœ‰åˆ©äºåŠæ—¶å‘ç°ç½‘ç»œæ”»å‡»çš„å‰å…†ï¼Œå‘ç°ç½‘ç»œæ”»å‡»è¡Œä¸ºï¼Œå¿«é€Ÿå®šä½ç½‘ç»œæœåŠ¡ä¸­å­˜åœ¨çš„æ¼æ´ï¼Œå¯¹ç½‘ç»œå®‰å…¨é˜²æŠ¤å·¥ä½œååˆ†æœ‰æ„ä¹‰ã€‚</p>
<p>æœ¬æ–‡ä»¥ä¸‹åˆ—ä¸‰ä¸ªå¸¸è§æ‰«æå™¨ä¸ºä»£è¡¨ï¼Œæ¢ç©¶æ‰«æå™¨çš„ç‰¹æœ‰æŒ‡çº¹ä¿¡æ¯ï¼Œç¼–å†™ Demo è¿›è¡Œæ‰«æå™¨çš„è¯†åˆ«ã€‚</p>
<p><img src="https://img.seriouszyx.com/202109011044955.png#vwid=1999&amp;vhei=694"></p>
<h2 id="Zmap"><a href="#Zmap" class="headerlink" title="Zmap"></a>Zmap</h2><h3 id="æŠ“åŒ…åˆ†æ"><a href="#æŠ“åŒ…åˆ†æ" class="headerlink" title="æŠ“åŒ…åˆ†æ"></a>æŠ“åŒ…åˆ†æ</h3><p>ZMap è¢«è®¾è®¡ç”¨æ¥é’ˆå¯¹æ•´ä¸ª IPv4 åœ°å€ç©ºé—´æˆ–å…¶ä¸­çš„å¤§éƒ¨åˆ†å®æ–½ç»¼åˆæ‰«æçš„å·¥å…·ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒZMap ä¼šå¯¹äºæŒ‡å®šç«¯å£å®æ–½å°½å¯èƒ½å¤§é€Ÿç‡çš„ TCP SYN æ‰«æã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå®¢æˆ·ç«¯åœ¨å‘é€ä¸€ä¸ª SYN åŒ…çš„æ—¶å€™ï¼Œå¦‚æœå¯¹æ–¹ç«¯å£å¼€æ”¾ï¼Œå°±ä¼šå‘é€ä¸€ä¸ª SYN-ACKï¼Œé‚£ä¹ˆå°±è¡¨æ˜è¿™ä¸ªç«¯å£å¼€æ”¾ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å‘é€ RST åŒ…ï¼Œé˜²æ­¢å ç”¨å¯¹æ–¹èµ„æºï¼›å¦‚æœå¯¹æ–¹ç«¯å£ä¸å¼€æ”¾ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¼šæ”¶åˆ°å¯¹æ–¹ä¸»æœºçš„ RST åŒ…ã€‚</p>
<p><img src="https://img.seriouszyx.com/202109011044047.png#vwid=2652&amp;vhei=1128"></p>
<p>è¾ƒä¸ºä¿å®ˆçš„æƒ…å†µä¸‹ï¼Œå¯¹ 10,000 ä¸ªéšæœºçš„åœ°å€çš„ 80 ç«¯å£ä»¥ 10Mbps çš„é€Ÿåº¦æ‰«æï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://img.seriouszyx.com/202109011044067.png#vwid=2225&amp;vhei=653"></p>
<p>åœ¨ç”Ÿæˆçš„ csv ç»“æœæ–‡ä»¶ä¸­ï¼Œä»¥ä¸‹ IP åœ°å€çš„ 80 ç«¯å£å¼€æ”¾ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">47.243</span>.139.246
<span class="token number">20.205</span>.204.152
<span class="token number">121.36</span>.193.65
<span class="token number">156.245</span>.39.71
<span class="token number">13.238</span>.233.150
<span class="token number">142.234</span>.31.240
<span class="token number">68.183</span>.75.244
<span class="token number">185.48</span>.122.237
<span class="token number">52.25</span>.116.123
<span class="token number">104.127</span>.1.181
<span class="token number">185.248</span>.102.245
<span class="token number">95.217</span>.201.8
<span class="token number">3.125</span>.24.134
<span class="token number">23.15</span>.117.202<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æŠ“åŒ…ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼ŒZmap å‘éšæœºçš„ 10,000 ä¸ª IP çš„ 80 ç«¯å£å‘é€ SYN æ•°æ®åŒ…ã€‚</p>
<p><img src="https://img.seriouszyx.com/202109011044558.png#vwid=2560&amp;vhei=908"></p>
<p>å¦‚æœ IP çš„ 80 ç«¯å£å¼€æ”¾ï¼Œä»¥ 47.243.139.246 ä¸ºä¾‹ï¼Œç­›é€‰å‡ºçš„æ•°æ®åŒ…å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…·ä½“è§£é‡Šä¸ºï¼š</p>
<ol>
<li>å‘ 47.243.139.246 çš„ 80 ç«¯å£å‘é€ SYN æ•°æ®åŒ…</li>
<li>æ¥æ”¶åˆ° 47.243.139.246 çš„ 80 ç«¯å£çš„ SYN/ACK åŒ…ï¼Œè¯æ˜è¯¥ IP çš„ 80 ç«¯å£å¯ç”¨</li>
<li>å‘ 47.243.139.246 çš„ 80 ç«¯å£å‘é€ RST æ•°æ®åŒ…ï¼Œé˜²æ­¢å ç”¨å¯¹æ–¹èµ„æº</li>
</ol>
<p><img src="https://img.seriouszyx.com/202109011044591.png#vwid=2560&amp;vhei=371"></p>
<p>å¦‚æœ IP çš„ 80 ç«¯å£ä¸å¼€æ”¾ï¼Œä»¥ 44.102.170.124 ä¸ºä¾‹ï¼Œç­›é€‰å‡ºçš„æ•°æ®åŒ…å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚Zmap å‘å…¶å‘é€ SYN è¯·æ±‚åæ²¡æœ‰å¾—åˆ°åº”ç­”ï¼Œæ•…åˆ¤æ–­è¯¥ IP çš„ 80 ç«¯å£ä¸å¯ç”¨ã€‚</p>
<p><img src="https://img.seriouszyx.com/202109011044623.png#vwid=2560&amp;vhei=235"></p>
<p>æŸ¥çœ‹ Zmap å‘å“ªäº› IP å‘é€äº† RST æ•°æ®åŒ…ï¼Œåˆ™è¯æ˜è¿™äº› IP çš„ 80 ç«¯å£å¯ç”¨ã€‚ç­›é€‰ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç›®çš„åœ°å€ä¸ä¸Šè¿°çš„ csv ç»“æœæ–‡ä»¶ä¸€è‡´ã€‚</p>
<p><img src="https://img.seriouszyx.com/202109011044663.png#vwid=2560&amp;vhei=798"></p>
<h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><p>Zmap æ•´ä½“å‡½æ•°è°ƒç”¨å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><img src="https://img.seriouszyx.com/202109011044692.png#vwid=942&amp;vhei=522"></p>
<p>é€šè¿‡å›¾æˆ‘ä»¬å¯ä»¥ç›´è§‚çš„çœ‹åˆ°æ•´ä¸ªç¨‹åºè°ƒç”¨çš„è¿‡ç¨‹ã€‚Zmap åœ¨å¯åŠ¨æ—¶å€™ï¼Œå…ˆè·å–ç¯å¢ƒä¿¡æ¯ï¼Œå¦‚ IPã€ç½‘å…³ç­‰ã€‚ç„¶åè¯»å–é…ç½®æ–‡ä»¶é€‰æ‹©ä½¿ç”¨å“ªç§æ‰«ææ–¹å¼ï¼Œç„¶ååœ¨ Probe_modules åˆ‡æ¢åˆ°å¯¹åº”çš„æ¨¡å—ï¼Œç„¶åå¯åŠ¨ã€‚</p>
<p>ä¸‹é¢ä¾§é‡åˆ†æ SYN æ‰«æè¿™ä¸ªæ¨¡å—ï¼Œæ•´ä¸ªæ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹ä¸“é—¨è´Ÿè´£å‘é€ï¼Œå¦å¤–æœ‰ä¸€ä¸ªä½¿ç”¨ libpcap ç»„ä»¶æŠ“åŒ…ï¼Œå‘é€å’Œæ¥æ”¶å°±ç‹¬ç«‹å¼€æ¥ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/zmap/zmap/blob/main/src/probe_modules/module_tcp_synscan.c">zmap/src/probe_modules/module_tcp_synscan.c</a> æ˜¯ç”¨äºæ‰§è¡Œ TCP SYN æ‰«æçš„æ¢æµ‹æ¨¡å—ï¼Œåœ¨åˆå§‹åŒ–é˜¶æ®µçš„ synscan_init_perthread å‡½æ•°ä¸­ï¼Œä¾æ¬¡è°ƒç”¨ make_ip_header å‡½æ•°å’Œ make_tcp_header å‡½æ•°è¿›è¡Œæ•°æ®åŒ… header çš„å°è£…ã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">synscan_init_perthread</span><span class="token punctuation">(</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>buf<span class="token punctuation">,</span> <span class="token class-name">macaddr_t</span> <span class="token operator">*</span>src<span class="token punctuation">,</span> <span class="token class-name">macaddr_t</span> <span class="token operator">*</span>gw<span class="token punctuation">,</span>
    <span class="token class-name">port_h_t</span> dst_port<span class="token punctuation">,</span>
    UNUSED <span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span>arg_ptr<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">ether_header</span> <span class="token operator">*</span>eth_header <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">ether_header</span> <span class="token operator">*</span><span class="token punctuation">)</span>buf<span class="token punctuation">;</span>
    <span class="token function">make_eth_header</span><span class="token punctuation">(</span>eth_header<span class="token punctuation">,</span> src<span class="token punctuation">,</span> gw<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">ip</span> <span class="token operator">*</span>ip_header <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">ip</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>eth_header<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">uint16_t</span> len <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">ip</span><span class="token punctuation">)</span> <span class="token operator">+</span> ZMAP_TCP_SYNSCAN_TCP_HEADER_LEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">make_ip_header</span><span class="token punctuation">(</span>ip_header<span class="token punctuation">,</span> IPPROTO_TCP<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">tcphdr</span> <span class="token operator">*</span>tcp_header <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">tcphdr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ip_header<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">make_tcp_header</span><span class="token punctuation">(</span>tcp_header<span class="token punctuation">,</span> dst_port<span class="token punctuation">,</span> TH_SYN<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">set_mss_option</span><span class="token punctuation">(</span>tcp_header<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> EXIT_SUCCESS<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¿™ä¸¤ä¸ªå‡½æ•°ç¼–å†™äº <a target="_blank" rel="noopener" href="https://github.com/zmap/zmap/blob/main/src/probe_modules/packet.c">zmap/src/probe_modules/packet.c</a> ä¸­ã€‚åˆ†æ make_ip_header å‡½æ•°å¯çŸ¥ï¼Œåœ¨ä¸‹ç¤ºç¬¬ 7 è¡Œï¼ŒIP çš„ identification number è¢«è®¾ç½®ä¸ºå›ºå®šçš„ 54321ã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">make_ip_header</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">ip</span> <span class="token operator">*</span>iph<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> protocol<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> len<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    iph<span class="token operator">-&gt;</span>ip_hl <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>  <span class="token comment">// Internet Header Length</span>
    iph<span class="token operator">-&gt;</span>ip_v <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>   <span class="token comment">// IPv4</span>
    iph<span class="token operator">-&gt;</span>ip_tos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// Type of Service</span>
    iph<span class="token operator">-&gt;</span>ip_len <span class="token operator">=</span> len<span class="token punctuation">;</span>
    iph<span class="token operator">-&gt;</span>ip_id <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token number">54321</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// identification number</span>
    iph<span class="token operator">-&gt;</span>ip_off <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>	   <span class="token comment">// fragmentation flag</span>
    iph<span class="token operator">-&gt;</span>ip_ttl <span class="token operator">=</span> MAXTTL<span class="token punctuation">;</span>      <span class="token comment">// time to live (TTL)</span>
    iph<span class="token operator">-&gt;</span>ip_p <span class="token operator">=</span> protocol<span class="token punctuation">;</span>      <span class="token comment">// upper layer protocol =&gt; TCP</span>
    <span class="token comment">// we set the checksum = 0 for now because that's</span>
    <span class="token comment">// what it needs to be when we run the IP checksum</span>
    iph<span class="token operator">-&gt;</span>ip_sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>åˆ†æ make_tcp_header å‡½æ•°å¯çŸ¥ï¼Œåœ¨ä¸‹ç¤ºç¬¬ 10 è¡Œï¼ŒTCP çš„ window è¢«è®¾ç½®ä¸ºå›ºå®šçš„ 65535ã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">make_tcp_header</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">tcphdr</span> <span class="token operator">*</span>tcp_header<span class="token punctuation">,</span> <span class="token class-name">port_h_t</span> dest_port<span class="token punctuation">,</span>
		     <span class="token class-name">uint16_t</span> th_flags<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    tcp_header<span class="token operator">-&gt;</span>th_seq <span class="token operator">=</span> <span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tcp_header<span class="token operator">-&gt;</span>th_ack <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    tcp_header<span class="token operator">-&gt;</span>th_x2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    tcp_header<span class="token operator">-&gt;</span>th_off <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// data offset</span>
    tcp_header<span class="token operator">-&gt;</span>th_flags <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    tcp_header<span class="token operator">-&gt;</span>th_flags <span class="token operator">|=</span> th_flags<span class="token punctuation">;</span>
    tcp_header<span class="token operator">-&gt;</span>th_win <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token number">65535</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// largest possible window</span>
    tcp_header<span class="token operator">-&gt;</span>th_sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    tcp_header<span class="token operator">-&gt;</span>th_urp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    tcp_header<span class="token operator">-&gt;</span>th_dport <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>dest_port<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æŸ¥çœ‹æŠ“å–çš„ SYN æ•°æ®åŒ…ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒIP çš„ ID å’Œ TCP çš„ window ç¡®å®ä¸º 54321 å’Œ 65535ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªå›ºå®šå€¼å¯ä½œä¸ºæ‰«æå™¨ç‰¹å¾ã€‚</p>
<p><img src="https://img.seriouszyx.com/202109011044714.png#vwid=2560&amp;vhei=1275"></p>
<h2 id="Angry-IP-Scanner"><a href="#Angry-IP-Scanner" class="headerlink" title="Angry IP Scanner"></a>Angry IP Scanner</h2><h3 id="æŠ“åŒ…åˆ†æ-1"><a href="#æŠ“åŒ…åˆ†æ-1" class="headerlink" title="æŠ“åŒ…åˆ†æ"></a>æŠ“åŒ…åˆ†æ</h3><p>Angry IP Scannerï¼ˆç®€ç§° angryipï¼‰ æ˜¯ä¸€æ¬¾å¼€æºè·¨å¹³å°çš„ç½‘ç»œæ‰«æå™¨ï¼Œä¸»è¦ç”¨äºæ‰«æ IP åœ°å€å’Œç«¯å£ã€‚</p>
<p>angryip é»˜è®¤ä½¿ç”¨ Windows ICMP æ–¹æ³•æ‰«æå„ä¸ª ip åœ°å€ï¼Œæ‰«ææ¯ä¸ª IP çš„ 80ã€443 å’Œ 8080 ç«¯å£ã€‚ä»¥ IP èŒƒå›´ 123.56.104.200~123.56.104.250 ä¸ºä¾‹ï¼Œæ‰«æç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œçº¢è‰²ä»£è¡¨ IP ä¸å¯ç”¨ï¼Œè“è‰²ä»£è¡¨ IP å¯ç”¨ç«¯å£ä¸å¯ç”¨ï¼Œç»¿è‰²ä»£è¡¨ IP å’Œç«¯å£å‡å¯ç”¨ã€‚</p>
<p><img src="https://img.seriouszyx.com/202109011044740.png#vwid=2558&amp;vhei=1534"></p>
<p>åœ¨æ•è·çš„æ•°æ®åŒ…ä¸­ï¼Œä»¥ 123.56.104.218 ä¸ºä¾‹ï¼Œè¯¥ IP è¢«æ ‡è®°ä¸ºç»¿è‰²ï¼Œä¸‹é¢æ˜¯ä¸å®ƒæœ‰å…³çš„æ•°æ®åŒ…æŠ“å–ç»“æœã€‚</p>
<p>å›¾ä¸­ç¬¬ä¸€ä¸ªçº¢æ¡†å¤„ angryip ä¸ 123.56.104.218 è¿›è¡Œäº† 3 æ¬¡ pingï¼Œä¸”éƒ½äºˆä»¥å›å¤ï¼Œè¯´æ˜è¯¥ IP å¯ç”¨ã€‚ç¬¬äºŒä¸ªçº¢æ¡†å¤„ angryip åˆ†åˆ«æµ‹è¯• 123.56.104.218 çš„ 80ã€443 å’Œ 8080 ç«¯å£ï¼Œå…¶ä¸­ 80 å’Œ 443 ç«¯å£äºˆä»¥å›å¤ï¼Œè¯´æ˜è¿™ä¸¤ä¸ªç«¯å£å¯ç”¨ã€‚</p>
<p><img src="https://img.seriouszyx.com/202109011044760.png#vwid=2560&amp;vhei=930"></p>
<p>åœ¨ä¸å¯ç”¨çš„ IP ä¸­ï¼Œä»¥ 123.56.104.204 ä¸ºä¾‹ï¼Œä¸å®ƒç›¸å…³çš„æ•°æ®åŒ…æŠ“å–ç»“æœå¦‚ä¸‹ã€‚angryip å‘å…¶å‘é€ 3 æ¬¡ ping è¯·æ±‚ï¼Œéƒ½æ²¡æœ‰å¾—åˆ°å›å¤ï¼Œåˆ™åˆ¤æ–­å…¶ IP ä¸å¯ç”¨ï¼Œä¹Ÿæ²¡æœ‰å‘å…¶ç«¯å£å‘é€æ•°æ®åŒ…ã€‚</p>
<p><img src="https://img.seriouszyx.com/202109011044783.png#vwid=2560&amp;vhei=325"></p>
<h3 id="æºç åˆ†æ-1"><a href="#æºç åˆ†æ-1" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><p>å› ä¸ºæ— è®º IP å’Œç«¯å£æ˜¯å¦å¯ç”¨ï¼Œangryip éƒ½ä¼šå…ˆå‘é€ ping æ•°æ®åŒ…ï¼Œæ‰€ä»¥é€šè¿‡ ping é˜¶æ®µçš„æºç åˆ†æå…¶å·¥å…·çš„ç‰¹å¾ã€‚</p>
<p>åˆ†æ <a target="_blank" rel="noopener" href="https://github.com/angryip/ipscan/blob/64ec7090acdba380a62d5d2e1a6c630cc5302197/test/net/azib/ipscan/core/net/ICMPSharedPingerTest.java">ipscan/test/net/azib/ipscan/core/net/ICMPSharedPingerTest.java</a> æºç ï¼Œè¯¥æµ‹è¯•ç±»è°ƒç”¨ pinger.ping () æ–¹æ³• 3 æ¬¡ï¼Œå¹¶è®¡ç®—å¹³å‡æ—¶é•¿ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ICMPSharedPingerTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Test</span> <span class="token annotation punctuation">@Ignore</span><span class="token punctuation">(</span><span class="token string">"this test works only under root"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
	<span class="token class-name">Pinger</span> pinger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ICMPSharedPinger</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">PingResult</span> result <span class="token operator">=</span> pinger<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ScanningSubject</span><span class="token punctuation">(</span><span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getLocalHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">assertTrue</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getAverageTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">assertTrue</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getAverageTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">assertTrue</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getTTL</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¯¥æ–¹æ³•åœ¨ <a target="_blank" rel="noopener" href="https://github.com/angryip/ipscan/blob/master/src/net/azib/ipscan/core/net/WindowsPinger.java">ipscan/test/net/azib/ipscan/core/net/WindowsPinger.java</a> ä¸­ï¼Œæºç å¦‚ä¸‹æ‰€ç¤ºï¼Œåˆ¤æ–­ IP ç±»å‹ï¼Œå¹¶è°ƒç”¨ IPv6 å’Œ IPv4 å¯¹åº”çš„æ–¹æ³•ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">PingResult</span> <span class="token function">ping</span><span class="token punctuation">(</span><span class="token class-name">ScanningSubject</span> subject<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>subject<span class="token punctuation">.</span><span class="token function">isIPv6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token function">ping6</span><span class="token punctuation">(</span>subject<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
	<span class="token keyword">return</span> <span class="token function">ping4</span><span class="token punctuation">(</span>subject<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä»¥ IPv4 ä¸ºä¾‹ï¼Œæ–¹æ³•ä¸­å®šä¹‰äº†æ•°æ®åŒ…çš„æ•°æ®å¤§å°ä¸º 32ï¼Œå³ sendDataSize = 32ã€‚åç»­ä½¿ç”¨ Memory () æ–¹æ³•åˆ›å»º SendData å¯¹è±¡ï¼Œå¹¶æœªå¯¹å…¶è¿›è¡Œèµ‹å€¼ï¼Œæ•…é»˜è®¤å€¼åº”å…¨ä¸º 0ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token class-name">PingResult</span> <span class="token function">ping4</span><span class="token punctuation">(</span><span class="token class-name">ScanningSubject</span> subject<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Pointer</span> handle <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">dll<span class="token punctuation">.</span></span>IcmpCreateFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>handle <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token string">"Unable to create Windows native ICMP handle"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> sendDataSize <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> replyDataSize <span class="token operator">=</span> sendDataSize <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IcmpEchoReply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token class-name">Pointer</span> sendData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Memory</span><span class="token punctuation">(</span>sendDataSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sendData<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>sendDataSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Pointer</span> replyData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Memory</span><span class="token punctuation">(</span>replyDataSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">PingResult</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PingResult</span><span class="token punctuation">(</span>subject<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
	<span class="token class-name">IpAddrByVal</span> ipaddr <span class="token operator">=</span> <span class="token function">toIpAddr</span><span class="token punctuation">(</span>subject<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> count <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> numReplies <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">dll<span class="token punctuation">.</span></span>IcmpSendEcho</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> ipaddr<span class="token punctuation">,</span> sendData<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> sendDataSize<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> replyData<span class="token punctuation">,</span> replyDataSize<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token class-name">IcmpEchoReply</span> echoReply <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IcmpEchoReply</span><span class="token punctuation">(</span>replyData<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">if</span> <span class="token punctuation">(</span>numReplies <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> echoReply<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>echoReply<span class="token punctuation">.</span>address<span class="token punctuation">.</span>bytes<span class="token punctuation">,</span> ipaddr<span class="token punctuation">.</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		result<span class="token punctuation">.</span><span class="token function">addReply</span><span class="token punctuation">(</span>echoReply<span class="token punctuation">.</span>roundTripTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
		result<span class="token punctuation">.</span><span class="token function">setTTL</span><span class="token punctuation">(</span>echoReply<span class="token punctuation">.</span>options<span class="token punctuation">.</span>ttl <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
	<span class="token class-name"><span class="token namespace">dll<span class="token punctuation">.</span></span>IcmpCloseHandle</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>åœ¨å®é™…æŠ“åŒ…ä¸­ï¼Œæ¯ä¸ªå‘å‡ºçš„ ICMP è¯·æ±‚ä¸­ï¼ŒData çš„å¤§å°å‡ä¸º 32 å­—èŠ‚ï¼Œä¸”å…¨ä¸º 0ï¼Œæ‰€ä»¥å¯å°†å®ƒä½œä¸º angryip çš„ç‰¹å¾ã€‚</p>
<p><img src="https://img.seriouszyx.com/202109011044806.png#vwid=2560&amp;vhei=1068"></p>
<h2 id="Masscan"><a href="#Masscan" class="headerlink" title="Masscan"></a>Masscan</h2><h3 id="æŠ“åŒ…åˆ†æ-2"><a href="#æŠ“åŒ…åˆ†æ-2" class="headerlink" title="æŠ“åŒ…åˆ†æ"></a>æŠ“åŒ…åˆ†æ</h3><p>Masscan é»˜è®¤ä½¿ç”¨ SYN æ‰«æï¼Œä»¥ IP 123.56.104.218 ä¸ºä¾‹ï¼Œæ‰«æå…¶ 1~600 ç«¯å£ï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><img src="https://img.seriouszyx.com/202109011044826.png#vwid=1346&amp;vhei=278"></p>
<p>æŠ“åŒ…ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼ŒMasscan å‘ 123.56.104.218 çš„ 1~600 ç«¯å£è¿›è¡ŒéšæœºåŒ–æ‰«æï¼Œå‘å‡º SYN è¯·æ±‚ã€‚</p>
<p><img src="https://img.seriouszyx.com/202109011044847.png#vwid=2560&amp;vhei=1250"></p>
<p> æŸ¥çœ‹ 80 ç«¯å£çš„æ•°æ®åŒ…ï¼Œä¸‹å›¾å¯çŸ¥ 80 ç«¯å£å‘ Masscan å›å¤ï¼Œè¯´æ˜è¯¥ç«¯å£å¯ç”¨ã€‚</p>
<p><img src="https://img.seriouszyx.com/202109011044871.png#vwid=2560&amp;vhei=277"></p>
<p>æŸ¥çœ‹ 81 ç«¯å£çš„æ•°æ®åŒ…ï¼Œå‘ç°å¹¶æ²¡æœ‰æ•°æ®åŒ…å›å¤ï¼Œè¯´æ˜è¯¥ç«¯å£ä¸å¯ç”¨ã€‚</p>
<p><img src="https://img.seriouszyx.com/202109011044891.png#vwid=2560&amp;vhei=162"></p>
<p>ç­›é€‰æ”¶åˆ°çš„ SYN/ACK æ•°æ®åŒ…ï¼Œå¾—åˆ° 22ã€443 å’Œ 80 ç«¯å£ï¼Œè¯´æ˜ 123.56.104.218 çš„ 1~600 ä¸­è¿™ 3 ä¸ªç«¯å£å¯ç”¨ã€‚</p>
<p><img src="https://img.seriouszyx.com/202109011044912.png#vwid=2560&amp;vhei=260"></p>
<h3 id="æºç åˆ†æ-2"><a href="#æºç åˆ†æ-2" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><p>è§‚å¯ŸæŠ“åŒ…åˆ†æä¸­ç»“æœå¯ä»¥å‘ç°ï¼Œæ‰€æœ‰å‘å‡ºçš„ SYN è¯·æ±‚ä¸­ï¼Œçª—å£å¤§å°éƒ½æ˜¯ 1024ã€‚</p>
<p><img src="https://img.seriouszyx.com/202109011044935.png#vwid=2560&amp;vhei=1250"></p>
<p>åœ¨ Masscan çš„ä¸»å‡½æ•° <a target="_blank" rel="noopener" href="https://github.com/robertdavidgraham/masscan/blob/master/src/main.c">masscan/src/main.c</a> æ–‡ä»¶ä¸­ï¼Œé»˜è®¤ä½¿ç”¨ä»¥ä¸‹ä»£ç åˆå§‹åŒ– TCP æ•°æ®åŒ…çš„æ¨¡æ¿ã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">template_packet_init</span><span class="token punctuation">(</span>
    parms<span class="token operator">-&gt;</span>tmplset<span class="token punctuation">,</span>
    parms<span class="token operator">-&gt;</span>source_mac<span class="token punctuation">,</span>
    parms<span class="token operator">-&gt;</span>router_mac_ipv4<span class="token punctuation">,</span>
    parms<span class="token operator">-&gt;</span>router_mac_ipv6<span class="token punctuation">,</span>
    masscan<span class="token operator">-&gt;</span>payloads<span class="token punctuation">.</span>udp<span class="token punctuation">,</span>
    masscan<span class="token operator">-&gt;</span>payloads<span class="token punctuation">.</span>oproto<span class="token punctuation">,</span>
    <span class="token function">stack_if_datalink</span><span class="token punctuation">(</span>masscan<span class="token operator">-&gt;</span>nic<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>adapter<span class="token punctuation">)</span><span class="token punctuation">,</span>
    masscan<span class="token operator">-&gt;</span>seed<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¯¥å‡½æ•°ä½äº <a target="_blank" rel="noopener" href="https://github.com/robertdavidgraham/masscan/blob/master/src/templ-pkt.c">masscan/src/templ.pkt.c</a> ä¸­ï¼Œå…¶ä¸­å¯¹äº TCP çš„åˆå§‹åŒ–ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/* [TCP] */</span>
<span class="token function">_template_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>templset<span class="token operator">-&gt;</span>pkts<span class="token punctuation">[</span>Proto_TCP<span class="token punctuation">]</span><span class="token punctuation">,</span>
               source_mac<span class="token punctuation">,</span> router_mac_ipv4<span class="token punctuation">,</span> router_mac_ipv6<span class="token punctuation">,</span>
               default_tcp_template<span class="token punctuation">,</span>
               <span class="token keyword">sizeof</span><span class="token punctuation">(</span>default_tcp_template<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
               data_link<span class="token punctuation">)</span><span class="token punctuation">;</span>
templset<span class="token operator">-&gt;</span>count<span class="token operator">++</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å…¶ä¸­è°ƒç”¨çš„ default_tcp_template å®šä¹‰åœ¨è¯¥æ–‡ä»¶å¤´éƒ¨ï¼Œä¸‹è¿° 7 è¡ŒæŒ‡å®š IP çš„ length ä¸º 40ï¼Œä¸‹è¿° 10 è¡ŒæŒ‡å®š TLL ä¸º 255ï¼Œä¸‹è¿° 18 è¡ŒæŒ‡å®š ack ä¸º 0ï¼Œä¸‹è¿° 21 è¡ŒæŒ‡å®š window çš„å¤§å°ä¸º 1024ï¼Œå¯ä»¥å°†è¿™äº›æŒ‡æ ‡è§†ä¸º Masscan çš„ç‰¹å¾ã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> default_tcp_template<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
    <span class="token string">"\0\1\2\3\4\5"</span>  <span class="token comment">/* Ethernet: destination */</span>
    <span class="token string">"\6\7\x8\x9\xa\xb"</span>  <span class="token comment">/* Ethernet: source */</span>
    <span class="token string">"\x08\x00"</span>      <span class="token comment">/* Ethernet type: IPv4 */</span>
    <span class="token string">"\x45"</span>          <span class="token comment">/* IP type */</span>
    <span class="token string">"\x00"</span>
    <span class="token string">"\x00\x28"</span>      <span class="token comment">/* total length = 40 bytes */</span>
    <span class="token string">"\x00\x00"</span>      <span class="token comment">/* identification */</span>
    <span class="token string">"\x00\x00"</span>      <span class="token comment">/* fragmentation flags */</span>
    <span class="token string">"\xFF\x06"</span>      <span class="token comment">/* TTL=255, proto=TCP */</span>
    <span class="token string">"\xFF\xFF"</span>      <span class="token comment">/* checksum */</span>
    <span class="token string">"\0\0\0\0"</span>      <span class="token comment">/* source address */</span>
    <span class="token string">"\0\0\0\0"</span>      <span class="token comment">/* destination address */</span>

    <span class="token string">"\0\0"</span>          <span class="token comment">/* source port */</span>
    <span class="token string">"\0\0"</span>          <span class="token comment">/* destination port */</span>
    <span class="token string">"\0\0\0\0"</span>      <span class="token comment">/* sequence number */</span>
    <span class="token string">"\0\0\0\0"</span>      <span class="token comment">/* ack number */</span>
    <span class="token string">"\x50"</span>          <span class="token comment">/* header length */</span>
    <span class="token string">"\x02"</span>          <span class="token comment">/* SYN */</span>
    <span class="token string">"\x04\x0"</span>        <span class="token comment">/* window fixed to 1024 */</span>
    <span class="token string">"\xFF\xFF"</span>      <span class="token comment">/* checksum */</span>
    <span class="token string">"\x00\x00"</span>      <span class="token comment">/* urgent pointer */</span>
    <span class="token string">"\x02\x04\x05\xb4"</span>  <span class="token comment">/* added options [mss 1460] */</span>
<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Demo-è®¾è®¡ä¸å®ç°"><a href="#Demo-è®¾è®¡ä¸å®ç°" class="headerlink" title="Demo è®¾è®¡ä¸å®ç°"></a>Demo è®¾è®¡ä¸å®ç°</h2><p>ç»è¿‡æŠ“åŒ…åˆ†æå’Œæºç åˆ†æåï¼Œå¯ä»¥æ€»ç»“ä¸‰ä¸ªæ‰«æå™¨çš„ç‰¹å¾å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚</p>
<p><img src="https://img.seriouszyx.com/202109011044988.png#vwid=1524&amp;vhei=877"></p>
<p>æ€»ä½“æ¥çœ‹ï¼Œä¸‰ä¸ªæ‰«æå™¨å·¥å…·éƒ½æ˜¯åŸºäºå•åŒ…çš„å¤´éƒ¨ä¿¡æ¯è¿›è¡Œè¯†åˆ«ï¼Œä¸”ç»è¿‡æºç ç¡®è®¤ï¼Œå±äºå¼ºç‰¹å¾ã€‚é‚£ä¹ˆè¯†åˆ«çš„å…·ä½“è®¾è®¡ä¹Ÿå°±å¾ˆå®¹æ˜“äº†ï¼Œå¯¹ pcap æ–‡ä»¶çš„æ¯ä¸ªæ•°æ®åŒ…è¿›è¡Œåˆ†ç±»ï¼Œåˆ¤æ–­å…¶æ˜¯å¦æ»¡è¶³ä¸Šè¿°ä¸‰ä¸ªæŒ‡çº¹ï¼Œæ ¸å¿ƒè¯†åˆ«æµç¨‹å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="https://img.seriouszyx.com/202109011044015.png#vwid=622&amp;vhei=624"></p>
<p>å…·ä½“å®ç°ä½¿ç”¨ Python çš„ Scrapy åŒ…è§£æ pcapï¼Œè¿›è¡Œç›¸å…³æ“ä½œï¼Œä»£ç å¾ˆçŸ­ï¼Œæ ¸å¿ƒéƒ¨åˆ†å¦‚ä¸‹ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> data <span class="token keyword">in</span> packets<span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token string">'TCP'</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        <span class="token comment"># è¯†åˆ« Zmap</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'TCP'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>window <span class="token operator">==</span> <span class="token number">65535</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'IP'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">==</span> <span class="token number">54321</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            isZmap <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token comment"># è¯†åˆ« Masscan</span>
        <span class="token keyword">if</span> data<span class="token punctuation">[</span><span class="token string">'TCP'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>window <span class="token operator">==</span> <span class="token number">1024</span> <span class="token keyword">and</span> data<span class="token punctuation">[</span><span class="token string">'TCP'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ack <span class="token operator">==</span> <span class="token number">0</span> \
                <span class="token keyword">and</span> data<span class="token punctuation">[</span><span class="token string">'IP'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ttl <span class="token operator">==</span> <span class="token number">255</span> <span class="token keyword">and</span> data<span class="token punctuation">[</span><span class="token string">'IP'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">len</span> <span class="token operator">==</span> <span class="token number">40</span><span class="token punctuation">:</span>
            isMasscan <span class="token operator">=</span> <span class="token boolean">True</span>
    <span class="token comment"># è¯†åˆ« Angry IP Scanner</span>
    <span class="token keyword">if</span> <span class="token string">'ICMP'</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">'Raw'</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>
            items <span class="token operator">=</span> processStr<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'Raw'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>load<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'Raw'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">32</span> <span class="token keyword">and</span> items <span class="token operator">==</span> ANGRYIP_FLAG<span class="token punctuation">:</span>
                isAngryip <span class="token operator">=</span> <span class="token boolean">True</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä»£ç æ”¾ç½®äº <a target="_blank" rel="noopener" href="https://github.com/seriouszyx/ScannerRecognition">GitHub</a>ã€‚</p>
<hr>
<p>å‚è€ƒï¼š</p>
<p><a target="_blank" rel="noopener" href="https://linux.cn/article-5860-1.html">äº’è”ç½‘æ‰«æå™¨ ZMap å®Œå…¨æ‰‹å†Œ</a></p>
<p><a target="_blank" rel="noopener" href="https://nanshihui.github.io/2017/03/29/zmap%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB%E4%B9%8Bzmap%E6%89%AB%E6%8F%8F%E5%BF%AB%E7%9A%84%E5%8E%9F%E5%9B%A0/">zmap æºç è§£è¯»ä¹‹ zmap æ‰«æå¿«çš„åŸå› </a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/al0ne/Nmap_Bypass_IDS">Nmap_Bypass_IDS</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44288604/article/details/115656891">å…¥ä¾µæ£€æµ‹ â€”â€”masscan (æ‰«æç¯‡)</a></p>

  </div>
  </article>

  <div id="paginator">
    
  </div>

  </div>

</main>

<footer class="site-footer h-card">
  
  <div class="wrapper">
    <div class="footer-col-wrapper">
      <div class="footer-col">
        <ul class="contact-list">
          <li class="p-name"><a class="black-link" href="/">
                seriouszyx 
              </a></li></ul>
      </div>
    </div>
  </div>
  
    <div class="text-center">
      
        <span class="text-gray-300 text-sm" id="busuanzi_container_site_pv">
          æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
        </span>
      
      
        <span class="text-gray-300 text-sm">â€¢</span>
      
      
          <span class="text-gray-300 text-sm" id="busuanzi_container_site_uv">
            æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äººæ¬¡
          </span>
      
    </div>
  
  
    <div class="text-center">
      <a class="text-gray-300 text-sm" target="_blank" rel="noopener" href="https://beian.miit.gov.cn">è¾½ICPå¤‡19014015å·</a>
    </div>
  
</footer>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>


  <script async src="https://cdn.jsdelivr.net/gh/sukkaw/busuanzi@latest/bsz.pure.mini.js">
</script>


  <script src="https://cdn.jsdelivr.net/npm/tocbot@4.18.2/dist/tocbot.min.js"></script>

<script>
  var Star = window.Star || {};
  var CONFIG = {
    fancybox: true,
    tocbot: true
  };
  window.CONFIG = CONFIG;
</script>
<script src="/js/utils.js"></script>
<script src="/js/star.js"></script>

</body>
</html>
