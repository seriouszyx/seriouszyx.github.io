---
layout: post
title: ðŸ’»ã€çŽ¯å¢ƒæ­å»ºã€‘æœåŠ¡å™¨å†…ç½‘ç©¿é€
date: 2021-02-14 13:40:49
---


æœ¬ç§‘ AI å®žéªŒå®¤çš„æœåŠ¡å™¨åœ¨å†…ç½‘éƒ¨ç½²ï¼Œç–«æƒ…æœŸé—´å¤§å®¶éƒ½æ²¡åŠžæ³•åœ¨å­¦æ ¡ï¼Œåˆéœ€è¦ä½¿ç”¨ GPU å®Œæˆä¸€äº›å·¥ä½œã€‚æ­£å¥½è€æ¿åˆæ·»ç½®äº†ä¸€å°æœåŠ¡å™¨ï¼Œæ´¾æˆ‘åšä¸€ä¸‹å†…ç½‘ç©¿é€ï¼Œæ–¹ä¾¿è¿œç¨‹ä½¿ç”¨ã€‚


## æœåŠ¡å™¨é…ç½®


ä¸»è¦æƒ³è®°å½•ä¸€ä¸‹è½¯ä»¶æ–¹é¢çš„é…ç½®ï¼Œæ‰€ä»¥æ€Žä¹ˆå®‰è£…æ»‘è½¨ã€æ€Žä¹ˆæŽ¥çº¿è¿™ç±»é—®é¢˜å°±ä¸èµ˜è¿°äº†ï¼Œä¸‹é¢çš„è¡¨æ ¼ä¸­è®°å½•äº†ä¸¤å°æœåŠ¡å™¨çš„è½¯ç¡¬ä»¶é…ç½®ã€‚



|  | server1 | server2 |
| --- | --- | --- |
| GPU | Tesla V100 16GÃ—2 | Quadro RTX 6000 24GÃ—2 |
| CPU | Intel Xeon Gold 5117 @ 2.00GHz | Intel Xeon Gold 6240R @ 2.40GHz |
| å†…å­˜ | 128G | 128G |
| ç¡¬ç›˜ | 20TB | 24TB |
| æ“ä½œç³»ç»Ÿ | Ubuntu 18.04 LTS | Ubuntu 18.04 LTS |



## å†…ç½‘ç©¿é€


ä¸Šè¿°ä¸¤å°æœåŠ¡å™¨éƒ½åœ¨å­¦é™¢æœºæˆ¿é‡Œï¼Œæ­¤å±€åŸŸç½‘çš„é™åˆ¶å¾ˆå¤§ï¼Œç”šè‡³å­¦æ ¡æä¾›çš„ VPN éƒ½æ— æ³•è®¿é—®ï¼Œå¿…é¡»è¦åœ¨å­¦é™¢å†…éƒ¨çš„ç½‘ç»œæ‰èƒ½è®¿é—®ã€‚å½“ç”¨æˆ·åœ¨å®¿èˆæˆ–è€…æ ¡å¤–ï¼Œæ˜¯æ²¡æœ‰å®˜æ–¹æä¾›çš„ä»£ç†å·¥å…·æ¥è¿žæŽ¥æœåŠ¡å™¨çš„ï¼Œæ‰€ä»¥å°±éœ€è¦ä¸€å°å…¬ç½‘æœåŠ¡å™¨åšè½¬å‘ï¼Œç”¨æˆ·é€šè¿‡å…¬ç½‘ ip æ¥è®¿é—®å†…ç½‘çš„æœåŠ¡å™¨ï¼Œè¿™å°±éœ€è¦å†…ç½‘ç©¿é€æŠ€æœ¯ã€‚


å¸‚é¢ä¸Šæœ‰ä¸€äº›æˆç†Ÿçš„å†…ç½‘ç©¿é€è½¯ä»¶ï¼Œå¦‚èŠ±ç”Ÿå£³ã€è’²å…¬è‹±ç­‰ï¼Œä½†å…è´¹ç‰ˆæœ¬å¤§å¤šæœ‰å¸¦å®½é™åˆ¶ï¼Œä¸”é€Ÿåº¦æžæ…¢ï¼Œæ— æ³•æ­£å¸¸ä½¿ç”¨ã€‚ç„¶è€Œè¿™äº›è½¯ä»¶åº•å±‚æˆ–å¤šæˆ–å°‘éƒ½ä¾èµ– [frp](https://github.com/fatedier/frp)ï¼Œä¸€æ¬¾ä¸“æ³¨äºŽå†…ç½‘ç©¿é€çš„é«˜æ€§èƒ½åå‘ä»£ç†åº”ç”¨ï¼Œæ”¯æŒå¤šç§åè®®ï¼Œå¯ä»¥å®‰å…¨çš„å°†å†…ç½‘æœåŠ¡é€šè¿‡å…¬ç½‘ ip èŠ‚ç‚¹çš„ä¸­è½¬æš´éœ²åˆ°å…¬ç½‘ã€‚


ç»è°ƒç ”åŽå‘çŽ°ï¼Œfrp åŽŸç”Ÿæ”¯æŒç«¯å£å¤ç”¨ï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªæœåŠ¡é€šè¿‡åŒä¸€ä¸ªæœåŠ¡ç«¯ç«¯å£æš´éœ²ã€‚è¿™æ ·å¯ä»¥ä½¿ç”¨ä¸€å°å…¬ç½‘æœåŠ¡å™¨åŒæ—¶ä»£ç†ä¸¤å°å†…ç½‘æœåŠ¡ï¼Œé€šè¿‡ä¸åŒå¤–ç½‘ç«¯å£è®¿é—®ä¸åŒçš„å†…ç½‘æœåŠ¡ã€‚


frp çš„å®‰è£…åŒ…åœ¨ [GitHub ](https://github.com/fatedier/frp/releases)ä¸Šï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¦æƒ³ä½¿ frp æ­£å¸¸å·¥ä½œï¼Œå¿…é¡»åœ¨ä¸åŒæœåŠ¡å™¨ä¸Šä¸‹è½½ç›¸åŒç‰ˆæœ¬çš„ frp åŒ…ã€‚


### æœåŠ¡ç«¯è®¾ç½®


> frp çš„æœåŠ¡ç«¯æ˜¯è¿›è¡Œä¸­è½¬çš„å…¬ç½‘æœåŠ¡å™¨ï¼Œå…·æœ‰ç‹¬ç«‹çš„å…¬ç½‘ ipã€‚



ä¸‹è½½è§£åŽ‹ frp åŒ…ï¼Œæˆ‘ä¸€èˆ¬æ”¾ç½®åœ¨ `/usr/local/frp/` ç›®å½•ä¸‹ï¼Œç¼–è¾‘æœåŠ¡ç«¯é…ç½®æ–‡ä»¶ `frps.ini` ã€‚


```bash
[common]
bind_port = 7000
vhost_http_port = 8899
```


å…¶ä¸­ï¼š


- â€œbind_portâ€è¡¨ç¤ºç”¨äºŽå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¿žæŽ¥çš„ç«¯å£ï¼Œè¿™ä¸ªç«¯å£å·æˆ‘ä»¬ä¹‹åŽåœ¨é…ç½®å®¢æˆ·ç«¯çš„æ—¶å€™è¦ç”¨åˆ°ã€‚
- â€œvhost_http_portâ€å’Œâ€œvhost_https_portâ€ç”¨äºŽåå‘ä»£ç† HTTP ä¸»æœºæ—¶ä½¿ç”¨ï¼Œæœ¬æ–‡ä¸æ¶‰åŠ HTTP åè®®ï¼Œå› è€Œç…§æŠ„æˆ–è€…åˆ é™¤è¿™æ¡å‡å¯ã€‚



ç¼–è¾‘å®ŒæˆåŽå³å¯ä¿å­˜ï¼Œè¿è¡ŒæœåŠ¡ç«¯åº”ç”¨ã€‚


```bash
./frps -c frps.ini
```


æ­¤æ—¶çš„æœåŠ¡ç«¯ä»…è¿è¡Œåœ¨å‰å°ï¼Œå¦‚æžœ `Ctrl+C` åœæ­¢æˆ–è€…å…³é—­ SSH çª—å£åŽï¼Œfrps å‡ä¼šåœæ­¢è¿è¡Œï¼Œå› è€Œæˆ‘ä»¬ä½¿ç”¨ [nohup å‘½ä»¤](https://www.runoob.com/linux/linux-comm-nohup.html)å°†å…¶è¿è¡Œåœ¨åŽå°ã€‚

```bash
nohup ./frps -c frps.ini &
```


è‡³æ­¤ï¼ŒæœåŠ¡ç«¯å³è®¾ç½®å®Œæˆï¼Œä½ å¯ä»¥å…³é—­SSHçª—å£äº†ã€‚

### å®¢æˆ·ç«¯é…ç½®


> frp çš„å®¢æˆ·ç«¯æ˜¯çœŸæ­£æƒ³è¦è®¿é—®çš„å†…ç½‘æœåŠ¡å™¨ã€‚



åŒæ ·ä¸‹è½½è§£åŽ‹å¥½ frp è½¯ä»¶ï¼Œæ³¨æ„ç‰ˆæœ¬çš„ç»Ÿä¸€ï¼Œç¼–è¾‘ä¸¤å°å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ `frpc.ini`ã€‚


```bash
[common]
server_addr = 39.106.21.214
server_port = 7000
 
[ssh]
type = tcp
local_ip = 172.10.1.185
local_port = 22
remote_port = 6666
```


```bash
[common]
server_addr = 39.106.21.214
server_port = 7000

[ssh1]
type = tcp
local_ip = 172.10.1.184
local_port = 22
remote_port = 6667
```


å…¶ä¸­ï¼š


- â€œserver_addrâ€ä¸ºæœåŠ¡ç«¯ ip åœ°å€ï¼Œå¡«å…¥å³å¯ã€‚
- â€œserver_portâ€ä¸ºæœåŠ¡å™¨ç«¯å£ï¼Œå¡«å…¥ä½ è®¾ç½®çš„ç«¯å£å·å³å¯ï¼Œå¦‚æžœæœªæ”¹å˜å°±æ˜¯7000ã€‚
- â€œ[xxx]â€è¡¨ç¤ºä¸€ä¸ªè§„åˆ™åç§°ï¼Œè‡ªå·±å®šä¹‰ï¼Œä¾¿äºŽæŸ¥è¯¢å³å¯ã€‚
- â€œtypeâ€è¡¨ç¤ºè½¬å‘çš„åè®®ç±»åž‹ï¼Œæœ‰ TCP å’Œ UDP ç­‰é€‰é¡¹å¯ä»¥é€‰æ‹©ï¼Œå¦‚æœ‰éœ€è¦è¯·è‡ªè¡ŒæŸ¥è¯¢ frp æ‰‹å†Œã€‚
- â€œlocal_portâ€æ˜¯æœ¬åœ°åº”ç”¨çš„ç«¯å£å·ï¼ŒæŒ‰ç…§å®žé™…åº”ç”¨å·¥ä½œåœ¨æœ¬æœºçš„ç«¯å£å·å¡«å†™å³å¯ã€‚
- â€œremote_portâ€æ˜¯è¯¥æ¡è§„åˆ™åœ¨æœåŠ¡ç«¯å¼€æ”¾çš„ç«¯å£å·ï¼Œè‡ªå·±å¡«å†™å¹¶è®°å½•å³å¯ã€‚



é…ç½®å¥½åŽå¯ä»¥ä½¿ç”¨åŒæ ·çš„æ–¹æ³•åŽå°è¿è¡Œå®¢æˆ·ç«¯ç¨‹åºã€‚


```bash
nohup ./frpc -c frpc.ini &
```


## æœåŠ¡é“¾æž¶æž„


ä¸‹é¢æ˜¯æ•´ä¸ª frp æœåŠ¡é“¾çš„æž¶æž„ï¼ˆå›¾ä¸­ ip åŠç«¯å£å·çš†ä¸ºæ¨¡æ‹Ÿå€¼ï¼‰ï¼š


![frp æž¶æž„](/assets/posts/expose-local-server/image.png)


å®žçº¿ä»£è¡¨ç›´æŽ¥ç½‘ç»œè¿žæŽ¥ï¼Œè™šçº¿ä»£è¡¨è™šæ‹Ÿç½‘ç»œè¿žæŽ¥ã€‚åœ¨å†…ç½‘æœåŠ¡å™¨ï¼ˆfrpcï¼‰ä¸­é…ç½®çš„ `remote_port` å°†åœ¨å¯åŠ¨åŽå‘å…¬ç½‘æœåŠ¡å™¨ï¼ˆfrpsï¼‰å‘é€ï¼ˆé€šè¿‡7000ç«¯å£ï¼‰æ³¨å†Œä¿¡æ¯ï¼Œå‘é€æˆåŠŸåŽï¼Œå…¬ç½‘æœåŠ¡å™¨å¼€å§‹ç›‘å¬6666å’Œ6667ä¸¤ä¸ªç«¯å£ã€‚


åœ¨å®žé™…è®¿é—®æ—¶ï¼Œç›´æŽ¥åœ¨ SSH å®¢æˆ·ç«¯è¾“å…¥å…¬ç½‘æœåŠ¡å™¨çš„ ip åœ°å€ï¼Œé€šè¿‡6666å’Œ6667ä¸¤ä¸ªç«¯å£å·æŽ§åˆ¶è®¿é—®ä¸¤å°å†…ç½‘æœåŠ¡å™¨ï¼Œè€Œå…¶ä¸­çš„ `server_port` ã€ `server_addr` ã€ `local_ip` å’Œ `local_port` ç­‰ä¿¡æ¯å¯¹ç”¨æˆ·é€æ˜Žï¼Œç®€å•æ–¹ä¾¿ã€‚


> å‚è€ƒï¼š
> - [ä½¿ç”¨frpè¿›è¡Œå†…ç½‘ç©¿é€](https://sspai.com/post/52523)
> - [frp issues 174](https://github.com/fatedier/frp/issues/174)